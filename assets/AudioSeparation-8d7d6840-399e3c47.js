import{V as e,v as s}from"./index-3111b9b5.js";import{LucideMusic as o,LucideWifi as t,LucideWifiOff as r,AlertCircle as l,LucideRefreshCw as a,LucideMusic3 as n,LucideVolume1 as c,LucideMusic2 as i,LucideMic as d,LucidePause as u,LucidePlay as x,Download as g,LucideVolumeX as m,LucideVolume2 as p,LucideTrash2 as h,Calendar as j,Clock as b,FileAudio as f,LucideUpload as y,CheckCircle as N,LucideX as v,LucideZap as S}from"./icons-3130b023-5920a354.js";var w=Object.defineProperty,A=Object.defineProperties,P=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertySymbols,I=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,k=(e,s,o)=>s in e?w(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o,O=(e,s)=>{for(var o in s||(s={}))I.call(s,o)&&k(e,o,s[o]);if($)for(var o of $(s))C.call(s,o)&&k(e,o,s[o]);return e},E=(e,s)=>A(e,P(s)),M=(e,s,o)=>new Promise((t,r)=>{var l=e=>{try{n(o.next(e))}catch(s){r(s)}},a=e=>{try{n(o.throw(e))}catch(s){r(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,a);n((o=o.apply(e,s)).next())});const L=()=>"https://kr-studio-completeai.onrender.com/api".replace(/\/$/,""),D=(e,...s)=>M(void 0,[e,...s],function*(e,s={}){const o=`${L()}${e}`;console.log(`🌐 [API] שולח בקשה ל: ${o}`),console.log(`🌐 [API] שיטת בקשה: ${s.method||"GET"}`),console.log("🌐 [API] כותרות:",s.headers),console.log("🌐 [API] גוף הבקשה:",s.body);try{const e=performance.now(),t=yield fetch(o,E(O({},s),{headers:O({"Content-Type":"application/json"},s.headers)})),r=performance.now()-e;if(console.log(`🌐 [API] תשובה התקבלה ב: ${r.toFixed(0)}ms`),console.log(`🌐 [API] סטטוס תשובה: ${t.status} ${t.statusText}`),console.log("🌐 [API] כותרות תשובה:",Object.fromEntries(t.headers.entries())),!t.ok){console.error(`❌ [API] שגיאה בתשובה: ${t.status} ${t.statusText}`);const e=yield t.text();throw console.error("❌ [API] תוכן שגיאה:",e),new Error(`HTTP ${t.status}: ${t.statusText}`)}const l=yield t.json();if(console.log("🌐 [API] נתוני תשובה:",l),l&&"boolean"==typeof l.success){if(!l.success)throw console.error("❌ [API] תשובה נכשלה:",l.error||"הבקשה נכשלה"),new Error(l.error||"הבקשה נכשלה");console.log("✅ [API] תשובה הצליחה")}return l}catch(t){throw console.error(`❌ [API] שגיאה בבקשה ל-${o}:`,t),console.error("❌ [API] פרטי השגיאה:",{message:t.message,stack:t.stack,name:t.name}),t}}),U=()=>M(void 0,null,function*(){console.log("📁 [API] טוען רשימת פרויקטים");try{const e=performance.now(),s=yield D("/api/projects"),o=performance.now()-e;return console.log(`📁 [API] פרויקטים נטענו ב: ${o.toFixed(0)}ms`),console.log(`📁 [API] מספר פרויקטים: ${Array.isArray(s)?s.length:"לא מערך"}`),s}catch(e){throw console.error("❌ [API] שגיאה בטעינת פרויקטים:",e),e}});function T({trackId:e,trackData:t,isPlaying:r,volume:l,isMuted:a,onPlay:h,onVolumeChange:j,onMuteToggle:b,onDownload:f}){return s.jsxs("div",{className:`border-2 rounded-lg p-4 ${(e=>{switch(e){case"vocals":return"border-blue-500 bg-blue-500/10";case"drums":return"border-green-500 bg-green-500/10";case"bass":return"border-purple-500 bg-purple-500/10";case"guitar":return"border-orange-500 bg-orange-500/10";default:return"border-gray-500 bg-gray-500/10"}})(e)}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[(e=>{switch(e){case"vocals":return s.jsx(d,{className:"w-5 h-5 text-blue-400"});case"drums":return s.jsx(i,{className:"w-5 h-5 text-green-400"});case"bass":return s.jsx(c,{className:"w-5 h-5 text-purple-400"});case"guitar":return s.jsx(n,{className:"w-5 h-5 text-orange-400"});default:return s.jsx(o,{className:"w-5 h-5 text-gray-400"})}})(e),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-white",children:(e=>{switch(e){case"vocals":return"ווקאל";case"drums":return"תופים";case"bass":return"בס";case"guitar":return"גיטרה";case"other":return"אחר";default:return e}})(e)}),s.jsx("p",{className:"text-sm text-gray-400",children:(null==t?void 0:t.duration)?`${Math.round(t.duration)}s`:"טוען..."})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:h,className:"p-2 rounded-lg transition-colors "+(r?"bg-red-600 hover:bg-red-700 text-white":"bg-green-600 hover:bg-green-700 text-white"),children:r?s.jsx(u,{className:"w-4 h-4"}):s.jsx(x,{className:"w-4 h-4"})}),s.jsx("button",{onClick:f,className:"p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",title:"הורד ערוץ",children:s.jsx(g,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:b,className:"p-2 rounded-lg transition-colors "+(a?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-600 hover:bg-gray-700 text-white"),title:a?"הפעל ערוץ":"השתק ערוץ",children:a?s.jsx(m,{className:"w-4 h-4"}):s.jsx(p,{className:"w-4 h-4"})}),s.jsx("div",{className:"flex-1",children:s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:l,onChange:e=>j(parseFloat(e.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider",disabled:a})}),s.jsxs("span",{className:"text-sm text-gray-400 w-12 text-right",children:[Math.round(100*l),"%"]})]}),s.jsx("div",{className:"mt-4 h-16 bg-gray-800 rounded-lg flex items-center justify-center",children:s.jsx("div",{className:"text-gray-500 text-sm",children:"גל אודיו"})})]})}function Z({project:e,onSelect:t,onDelete:r}){const l="completed"===(a=e).status?{text:"הושלם",color:"text-green-400",bg:"bg-green-500/10"}:"processing"===a.status?{text:"מעבד",color:"text-yellow-400",bg:"bg-yellow-500/10"}:"failed"===a.status?{text:"נכשל",color:"text-red-400",bg:"bg-red-500/10"}:{text:"לא ידוע",color:"text-gray-400",bg:"bg-gray-500/10"};var a,n;return s.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4 hover:border-purple-500/50 transition-all duration-300",children:[s.jsxs("div",{className:"flex items-start justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center",children:s.jsx(o,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-white text-lg truncate max-w-32",children:e.name||"פרויקט ללא שם"}),s.jsx("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${l.bg} ${l.color}`,children:l.text})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:()=>t(e),className:"p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",title:"פתח פרויקט",children:s.jsx(x,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>r(e.id),className:"p-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",title:"מחק פרויקט",children:s.jsx(h,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"text-gray-400",children:"ערוצים מופרדים:"}),s.jsxs("span",{className:"text-white font-medium",children:[(n=e,n.stems?Object.keys(n.stems).length:0),"/5"]})]}),e.createdAt&&s.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-400",children:[s.jsx(j,{className:"w-4 h-4"}),s.jsx("span",{children:(e=>{try{return new Date(e).toLocaleDateString("he-IL",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(s){return"תאריך לא ידוע"}})(e.createdAt)})]}),e.duration&&s.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-400",children:[s.jsx(b,{className:"w-4 h-4"}),s.jsxs("span",{children:[Math.round(e.duration),"s"]})]})]}),e.stems&&Object.keys(e.stems).length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"ערוצים זמינים:"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(e.stems).map(e=>s.jsx("span",{className:"px-2 py-1 bg-gray-700 text-gray-300 text-xs rounded-full",children:"vocals"===e?"ווקאל":"drums"===e?"תופים":"bass"===e?"בס":"guitar"===e?"גיטרה":"other"===e?"אחר":e},e))})]}),s.jsx("div",{className:"mt-4 pt-3 border-t border-gray-700",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("button",{onClick:()=>t(e),className:"flex-1 bg-gradient-to-r from-purple-500 to-blue-600 hover:from-purple-600 hover:to-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-all duration-300 mr-2",children:"פתח בסטודיו"}),e.stems&&Object.keys(e.stems).length>0&&s.jsx("button",{onClick:()=>{Object.keys(e.stems).forEach(e=>{})},className:"p-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",title:"הורד את כל הערוצים",children:s.jsx(g,{className:"w-4 h-4"})})]})})]})}function F(){return s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-24 h-24 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(o,{className:"w-12 h-12 text-gray-400"})}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-3",children:"אין ערוצי אודיו זמינים"}),s.jsx("p",{className:"text-gray-400 mb-6 max-w-md mx-auto",children:"עדיין לא הופרדו ערוצי אודיו לפרויקט זה. אנא המתן לסיום התהליך או צור פרויקט חדש."}),s.jsxs("div",{className:"flex items-center justify-center space-x-4 text-sm text-gray-500",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsx("span",{children:"ווקאל"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsx("span",{children:"תופים"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsx("span",{children:"בס"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsx("span",{children:"גיטרה"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsx("span",{children:"אחר"})]})]})]})}function z({onFileSelect:o,onDrop:t,disabled:r=!1}){const[l,a]=e.useState(!1),[n,c]=e.useState(null);e.useRef(null);const i=e=>{console.log(`🖱️ [UploadZone] Drag Over - disabled: ${r}`),r||(e.preventDefault(),a(!0),console.log("✅ [UploadZone] Drag Over הופעל"))};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"border-2 border-dashed rounded-xl p-8 text-center transition-all duration-300 "+(r?"border-gray-500 bg-gray-800/50 cursor-not-allowed opacity-50":l?"border-purple-500 bg-purple-500/10 cursor-pointer":"border-gray-600 hover:border-purple-500 hover:bg-gray-800/50 cursor-pointer"),onDrop:e=>{if(console.log(`🖱️ [UploadZone] Drop - disabled: ${r}`),r)return;e.preventDefault(),a(!1);const s=Array.from(e.dataTransfer.files);if(console.log("📁 [UploadZone] קבצים שהועברו:",s.map(e=>({name:e.name,size:e.size,type:e.type}))),s.length>0){const e=s[0];console.log(`📁 [UploadZone] קובץ נבחר: ${e.name} (${e.size} bytes, ${e.type})`);try{c(e),t(e),console.log("✅ [UploadZone] קובץ נמסר בהצלחה")}catch(o){console.error("❌ [UploadZone] שגיאה במסירת קובץ:",o)}}else console.log("⚠️ [UploadZone] לא נמצאו קבצים ב-Drop")},onDragOver:i,onDragEnter:i,onDragLeave:e=>{console.log("🖱️ [UploadZone] Drag Leave"),e.preventDefault(),a(!1),console.log("✅ [UploadZone] Drag Leave הופעל")},onClick:()=>{var e;console.log(`🖱️ [UploadZone] לחיצה על אזור העלאה - disabled: ${r}`),r?console.log("⚠️ [UploadZone] העלאה מושבתת"):(console.log("✅ [UploadZone] פותח בחירת קובץ"),null==(e=document.getElementById("file-input"))||e.click())},children:[s.jsx("input",{id:"file-input",type:"file",accept:"audio/*",onChange:e=>{if(console.log(`🖱️ [UploadZone] File Input - disabled: ${r}`),r)return;const s=Array.from(e.target.files);if(console.log("📁 [UploadZone] קבצים נבחרו:",s.map(e=>({name:e.name,size:e.size,type:e.type}))),s.length>0){const e=s[0];console.log(`📁 [UploadZone] קובץ נבחר: ${e.name} (${e.size} bytes, ${e.type})`);try{c(e),o(e),console.log("✅ [UploadZone] קובץ נמסר בהצלחה")}catch(t){console.error("❌ [UploadZone] שגיאה במסירת קובץ:",t)}}else console.log("⚠️ [UploadZone] לא נמצאו קבצים בבחירה")},className:"hidden",disabled:r}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center mx-auto",children:s.jsx(y,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"העלה קובץ אודיו"}),s.jsx("p",{className:"text-gray-400",children:"גרור וזרוק קובץ אודיו לכאן, או לחץ לבחירה"})]}),s.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[s.jsx("p",{children:"קבצים נתמכים: MP3, WAV, FLAC, M4A, OGG"}),s.jsx("p",{children:"גודל מקסימלי: 50MB"})]})]})]}),n&&s.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(f,{className:"w-8 h-8 text-blue-400"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-medium text-white truncate",children:n.name}),s.jsxs("p",{className:"text-sm text-gray-400",children:[(e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024)),o=parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s];return console.log(`📏 [UploadZone] גודל קובץ: ${e} bytes = ${o}`),o})(n.size)," • ",n.type]})]}),s.jsx("div",{className:"text-green-400 text-sm font-medium",children:"נבחר"})]})}),s.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-blue-200 mb-2",children:"איך זה עובד?"}),s.jsxs("ol",{className:"text-blue-200 text-sm space-y-1 list-decimal list-inside",children:[s.jsx("li",{children:"העלה קובץ אודיו (שיר, הקלטה, או כל קובץ אודיו אחר)"}),s.jsx("li",{children:"המערכת תנתח את האודיו ותפריד אותו ל-5 ערוצים נפרדים"}),s.jsx("li",{children:"קבל גישה לכל ערוץ בנפרד: ווקאל, תופים, בס, גיטרה ואחר"}),s.jsx("li",{children:"הורד כל ערוץ בנפרד או ערבב אותם מחדש בסטודיו"})]})]}),s.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-white mb-2",children:"טיפים לאודיו איכותי"}),s.jsxs("ul",{className:"text-gray-300 text-sm space-y-1",children:[s.jsx("li",{children:"• השתמש בקבצי אודיו באיכות גבוהה (320kbps MP3 או WAV)"}),s.jsx("li",{children:"• הימנע מקבצים עם רעש רקע מוגזם"}),s.jsx("li",{children:"• אורך אופטימלי: 1-10 דקות"}),s.jsx("li",{children:"• תהליך ההפרדה לוקח 2-5 דקות בהתאם לאורך הקובץ"})]})]})]})}function J({step:o,progress:t,error:r,fileName:n,onRetry:c,onCancel:i}){console.log("📊 [ProcessingStatus] רכיב נטען עם:",{step:o,progress:t,error:null==r?void 0:r.message,fileName:n});const[d,u]=e.useState(0),[x,g]=e.useState(null);e.useEffect(()=>{let e;return"uploading"!==o&&"separating"!==o&&"processing"!==o||(e=setInterval(()=>{u(e=>e+1)},1e3)),()=>clearInterval(e)},[o]),e.useEffect(()=>{if(t>0&&d>0){const e=d/t*100,s=Math.max(0,e-d);g(Math.round(s))}},[t,d]);const m=e=>{if(!e||e<0)return"00:00";const s=Math.floor(e/60),o=Math.floor(e%60),t=`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`;return console.log(`⏰ [ProcessingStatus] זמן מעוצב: ${e}s = ${t}`),t},p=e=>{switch(console.log(`🎨 [ProcessingStatus] מחפש צבע עבור שלב: ${e}`),e){case"uploading":return console.log("🎨 [ProcessingStatus] צבע Uploading: from-blue-500 to-blue-600"),"from-blue-500 to-blue-600";case"separating":return console.log("🎨 [ProcessingStatus] צבע Separating: from-purple-500 to-purple-600"),"from-purple-500 to-purple-600";case"monitoring":return console.log("🎨 [ProcessingStatus] צבע Monitoring: from-green-500 to-green-600"),"from-green-500 to-green-600";case"completed":return console.log("🎨 [ProcessingStatus] צבע Completed: from-green-500 to-green-600"),"from-green-500 to-green-600";case"error":return console.log("🎨 [ProcessingStatus] צבע Error: from-red-500 to-red-600"),"from-red-500 to-red-600";default:return console.log(`🎨 [ProcessingStatus] צבע ברירת מחדל עבור: ${e}`),"from-purple-500 to-purple-600"}},h=()=>{console.log("🔄 [ProcessingStatus] כפתור Retry נלחץ");try{null==c||c(),console.log("✅ [ProcessingStatus] Retry הופעל בהצלחה")}catch(e){console.error("❌ [ProcessingStatus] שגיאה ב-Retry:",e)}};return s.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:`w-16 h-16 bg-gradient-to-r ${p(o)} rounded-xl flex items-center justify-center`,children:(e=>{switch(console.log(`🎨 [ProcessingStatus] מחפש אייקון עבור שלב: ${e}`),e){case"uploading":return console.log("🎨 [ProcessingStatus] אייקון Uploading: Upload"),s.jsx(Upload,{className:"w-8 h-8 text-blue-400"});case"separating":return console.log("🎨 [ProcessingStatus] אייקון Separating: Split"),s.jsx(Split,{className:"w-8 h-8 text-purple-400"});case"monitoring":return console.log("🎨 [ProcessingStatus] אייקון Monitoring: Eye"),s.jsx(Eye,{className:"w-8 h-8 text-green-400"});case"completed":return console.log("🎨 [ProcessingStatus] אייקון Completed: CheckCircle"),s.jsx(N,{className:"w-8 h-8 text-green-400"});case"error":return console.log("🎨 [ProcessingStatus] אייקון Error: XCircle"),s.jsx(XCircle,{className:"w-8 h-8 text-red-400"});default:return console.log(`🎨 [ProcessingStatus] אייקון ברירת מחדל עבור: ${e}`),s.jsx(Circle,{className:"w-8 h-8 text-purple-400"})}})(o)}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-bold text-white",children:(e=>{switch(console.log(`📝 [ProcessingStatus] מחפש טקסט עבור שלב: ${e}`),e){case"uploading":return console.log("📝 [ProcessingStatus] טקסט Uploading: מעלה קובץ..."),"מעלה קובץ...";case"separating":return console.log("📝 [ProcessingStatus] טקסט Separating: מפריד ערוצים..."),"מפריד ערוצים...";case"monitoring":return console.log("📝 [ProcessingStatus] טקסט Monitoring: עוקב אחר התקדמות..."),"עוקב אחר התקדמות...";case"completed":return console.log("📝 [ProcessingStatus] טקסט Completed: הושלם בהצלחה!"),"הושלם בהצלחה!";case"error":return console.log("📝 [ProcessingStatus] טקסט Error: שגיאה בעיבוד"),"שגיאה בעיבוד";default:return console.log(`📝 [ProcessingStatus] טקסט ברירת מחדל עבור: ${e}`),"מעבד..."}})(o)}),s.jsx("p",{className:"text-gray-400",children:(e=>{switch(console.log(`📄 [ProcessingStatus] מחפש תיאור עבור שלב: ${e}`),e){case"uploading":return console.log("📄 [ProcessingStatus] תיאור Uploading: מעלה את הקובץ לשרת..."),"מעלה את הקובץ לשרת...";case"separating":return console.log("📄 [ProcessingStatus] תיאור Separating: מפריד את האודיו לערוצים נפרדים..."),"מפריד את האודיו לערוצים נפרדים...";case"monitoring":return console.log("📄 [ProcessingStatus] תיאור Monitoring: עוקב אחר התקדמות ההפרדה..."),"עוקב אחר התקדמות ההפרדה...";case"completed":return console.log("📄 [ProcessingStatus] תיאור Completed: ההפרדה הושלמה בהצלחה!"),"ההפרדה הושלמה בהצלחה!";case"error":return console.log("📄 [ProcessingStatus] תיאור Error: אירעה שגיאה בעיבוד הקובץ"),"אירעה שגיאה בעיבוד הקובץ";default:return console.log(`📄 [ProcessingStatus] תיאור ברירת מחדל עבור: ${e}`),"מעבד את הקובץ..."}})(o)})]})]}),i&&s.jsx("button",{onClick:()=>{console.log("❌ [ProcessingStatus] כפתור Cancel נלחץ");try{null==i||i(),console.log("✅ [ProcessingStatus] Cancel הופעל בהצלחה")}catch(e){console.error("❌ [ProcessingStatus] שגיאה ב-Cancel:",e)}},className:"p-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",title:"בטל תהליך",children:s.jsx(v,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"התקדמות"}),s.jsxs("span",{className:"text-sm font-medium text-white",children:[Math.round(t),"%"]})]}),s.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:s.jsx("div",{className:`h-3 bg-gradient-to-r ${p(o)} rounded-full transition-all duration-500 ease-out`,style:{width:`${t}%`}})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(b,{className:"w-4 h-4 text-gray-400"}),s.jsx("span",{className:"text-sm text-gray-400",children:"זמן שחלף"})]}),s.jsx("span",{className:"text-lg font-semibold text-white",children:m(d)})]}),null!==x&&s.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(b,{className:"w-4 h-4 text-gray-400"}),s.jsx("span",{className:"text-sm text-gray-400",children:"זמן משוער נותר"})]}),s.jsx("span",{className:"text-lg font-semibold text-white",children:m(x)})]})]}),n&&s.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-4 mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(f,{className:"w-4 h-4 text-gray-400"}),s.jsx("span",{className:"text-sm text-gray-400",children:"קובץ"})]}),s.jsx("span",{className:"text-white font-medium truncate",children:n})]}),r&&s.jsxs("div",{className:"bg-red-900/50 border border-red-500 rounded-lg p-4 mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(l,{className:"w-5 h-5 text-red-400"}),s.jsx("span",{className:"text-red-200 font-medium",children:"שגיאה"})]}),s.jsx("p",{className:"text-red-200",children:r})]}),r&&c&&s.jsx("div",{className:"flex items-center justify-center space-x-4",children:s.jsxs("button",{onClick:h,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center space-x-2",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{children:"נסה שוב"})]})}),"loading-project"===o&&c&&s.jsx("div",{className:"flex items-center justify-center space-x-4",children:s.jsxs("button",{onClick:h,className:"bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center space-x-2",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{children:"נסה לטעון שוב"})]})}),"separating"===o&&s.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(S,{className:"w-4 h-4 text-blue-400"}),s.jsx("span",{className:"text-blue-200 font-medium",children:"טיפים לעיבוד"})]}),s.jsxs("ul",{className:"text-blue-200 text-sm space-y-1",children:[s.jsx("li",{children:"• הפרדת אודיו איכותית לוקחת זמן - אנא המתן בסבלנות"}),s.jsx("li",{children:"• איכות התוצאה תלויה באיכות הקובץ המקורי"}),s.jsx("li",{children:"• ניתן לסגור את הדף - התהליך ימשיך לפעול בשרת"})]})]}),"loading-project"===o&&s.jsxs("div",{className:"bg-green-900/20 border border-green-500/30 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(a,{className:"w-4 h-4 text-green-400"}),s.jsx("span",{className:"text-green-200 font-medium",children:"טיפים לטעינת פרויקט"})]}),s.jsxs("ul",{className:"text-green-200 text-sm space-y-1",children:[s.jsx("li",{children:"• ההפרדה הושלמה! המערכת טוענת את הפרויקט המוכן"}),s.jsx("li",{children:'• אם הטעינה נכשלת, לחץ על "נסה לטעון שוב"'}),s.jsx("li",{children:'• ניתן גם ללחוץ על "פתח בסטודיו" מהרשימה למטה'}),s.jsx("li",{children:"• המערכת תנסה לטעון אוטומטית מספר פעמים"})]})]})]})}const R=()=>{const[n,c]=e.useState(null),[i,d]=e.useState(""),[u,x]=e.useState(!1),[g,m]=e.useState(0),[p,h]=e.useState([]),[j,b]=e.useState(null),[f,y]=e.useState({}),[N,v]=e.useState(null),[S,w]=e.useState({}),[A,P]=e.useState(0),[$,I]=e.useState(0),[C,k]=e.useState({}),[R,B]=e.useState({}),[V,G]=e.useState("upload"),[W,X]=e.useState(!0),[K,H]=e.useState(null),[_,q]=e.useState("uploading"),[Q,Y]=e.useState(!1),[ee,se]=e.useState(null),[oe,te]=e.useState(null),[re,le]=e.useState(null),[ae,ne]=e.useState(null),[ce,ie]=e.useState("checking");e.useState(null),e.useState(!1),e.useRef();const de=e.useRef();e.useEffect(()=>{try{return de.current=new(window.AudioContext||window.webkitAudioContext),()=>{de.current&&de.current.close(),Object.keys(f).length>0&&pe()}}catch(e){console.error("❌ שגיאה ביצירת AudioContext:",e),se("שגיאה באתחול מערכת האודיו - נסה לרענן את הדף")}},[f]),e.useEffect(()=>{try{fe()}catch(e){console.error("❌ שגיאה בבדיקת חיבור לשרת:",e),se("שגיאה בבדיקת חיבור לשרת - נסה לרענן את הדף")}},[]);const ue=e=>M(void 0,null,function*(){console.log(`🔍 [AudioSeparation] טוען פרויקט: ${e}`);try{console.log(`🔍 [AudioSeparation] שולח בקשה לשרת: /api/projects/${e}`);const o=yield(s=e,M(void 0,null,function*(){console.log(`📁 [API] טוען פרויקט: id=${s}`);try{const e=performance.now(),o=yield D(`/api/projects/${s}`),t=performance.now()-e;return console.log(`📁 [API] פרויקט נטען ב: ${t.toFixed(0)}ms`),console.log("📁 [API] פרטי פרויקט:",o),o}catch(e){throw console.error(`❌ [API] שגיאה בטעינת פרויקט ${s}:`,e),e}}));console.log("🔍 [AudioSeparation] תשובה מהשרת:",o),o?(console.log("🔍 [AudioSeparation] פרויקט נטען בהצלחה:",o.projectName),h(s=>s.map(s=>s.id===e?E(O(O({},s),o),{status:"completed",progress:100}):s)),b(o),G("studio")):console.log("🔍 [AudioSeparation] פרויקט לא נמצא בשרת")}catch(o){console.error(`❌ [AudioSeparation] שגיאה בטעינת פרויקט ${e}:`,o),console.log("🔍 [AudioSeparation] מנסה לטעון פרויקט מ-localStorage...");const s=JSON.parse(localStorage.getItem("audioSeparationProjects")||"[]").find(s=>s.id===e);s&&(console.log("🔍 [AudioSeparation] פרויקט נמצא ב-localStorage:",s.projectName),b(s),G("studio"))}var s}),xe=e=>M(void 0,null,function*(){if(console.log("📁 [AudioSeparation] קובץ נבחר:",e.name,"גודל:",e.size,"סוג:",e.type),e)return["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/ogg"].includes(e.type)?e.size>104857600?(console.log("❌ [AudioSeparation] קובץ גדול מדי:",e.size/1048576,"MB"),void alert("הקובץ גדול מדי. גודל מקסימלי: 100MB")):(console.log("✅ [AudioSeparation] קובץ תקין, ממשיך..."),c(e),void G("upload")):(console.log("❌ [AudioSeparation] סוג קובץ לא נתמך:",e.type),void alert("סוג קובץ לא נתמך. אנא בחר קובץ אודיו (MP3, WAV, FLAC, M4A, OGG)"));console.log("❌ [AudioSeparation] קובץ לא תקין")}),ge=()=>M(void 0,null,function*(){console.log("🔄 מנסה שוב את התהליך..."),se(null);try{if(j&&j.id){console.log("🔄 מנסה לטעון פרויקט קיים:",j.id);const e=yield(e=>M(void 0,null,function*(){console.log(`🔍 [AudioSeparation] בודק סטטוס פרויקט מתקדם: ${e}`);try{console.log(`🔍 [AudioSeparation] שולח בקשה לשרת: /api/separate/${e}/progress`);const o=yield(s=e,M(void 0,null,function*(){console.log(`📊 [API] בודק התקדמות הפרדה: fileId=${s}`);try{const e=performance.now(),o=yield D(`/api/separate/${s}/progress`),t=performance.now()-e;return console.log(`📊 [API] התקדמות התקבלה ב: ${t.toFixed(0)}ms`),console.log("📊 [API] נתוני התקדמות:",o),o}catch(e){throw console.error("❌ [API] שגיאה בבדיקת התקדמות:",e),e}}));console.log("🔍 [AudioSeparation] תשובה מהשרת:",o),o&&void 0!==o.progress&&(console.log(`🔍 [AudioSeparation] עדכון סטטוס: ${o.progress}% - ${o.status}`),h(s=>s.map(s=>s.id===e?E(O({},s),{progress:o.progress,status:o.status}):s)),"completed"===o.status&&(console.log(`🔍 [AudioSeparation] פרויקט הושלם: ${e}`),yield ue(e)))}catch(o){console.error(`❌ [AudioSeparation] שגיאה בבדיקת סטטוס פרויקט ${e}:`,o),console.log("🔍 [AudioSeparation] מנסה לטעון פרויקט ישירות...");try{yield ue(e)}catch(t){console.error(`❌ [AudioSeparation] שגיאה בטעינת פרויקט ${e}:`,t)}}var s}))(j.id);return console.log("🔍 סטטוס פרויקט:",e),e.isReady?(yield ue(j.id))?(console.log("🎉 הפרויקט נטען בהצלחה!"),void se(null)):(console.error("❌ הפרויקט לא נטען למרות שהוא מוכן"),void se("הפרויקט מוכן אבל לא נטען. נסה לרענן את הדף.")):(console.warn("⚠️ הפרויקט לא מוכן:",e.reason),se(e.reason),void("loading-project"===_&&(console.log("⏳ ממתין 5 שניות ונסה שוב..."),setTimeout(()=>{ge()},5e3))))}K?(console.log("🔄 מנסה שוב עם הקובץ המקורי..."),yield xe(K)):n?(console.log("🔄 מנסה שוב עם הקובץ שהועלה..."),yield xe(n)):(console.log("🔄 אין קובץ זמין, חוזר למסך העלאה..."),he())}catch(e){console.error("❌ שגיאה בניסיון חוזר:",e),se(`ניסיון חוזר נכשל: ${e.message}`)}}),me=()=>{console.log("❌ מבטל תהליך...");try{ae&&(ae.abort(),ne(null)),re&&(clearInterval(re),le(null)),x(!1),q(null),m(0),se(null),c(null),H(null),d(""),console.log("✅ תהליך בוטל")}catch(e){console.error("❌ שגיאה בביטול תהליך:",e),se("שגיאה בביטול התהליך - נסה שוב")}},pe=()=>{try{Object.values(S).forEach(e=>{e&&(e.pause(),e.currentTime=0)}),w({}),v(null),P(0)}catch(e){console.error("❌ שגיאה בעצירת כל הערוצים:",e)}},he=()=>{try{G("upload"),X(!0),b(null),y({}),se(null),m(0),q(null),x(!1),pe(),re&&(clearInterval(re),le(null)),console.log("✅ חזרה למסך העלאה")}catch(e){console.error("❌ שגיאה בחזרה למסך העלאה:",e),se("שגיאה בחזרה למסך העלאה - נסה שוב")}};if(e.useEffect(()=>()=>{try{re&&clearInterval(re),ae&&ae.abort(),pe()}catch(e){console.error("❌ שגיאה בניקוי הקומפוננטה:",e)}},[re,ae]),"disconnected"===ce)return s.jsx("div",{className:"min-h-screen bg-gray-900 text-white p-6",children:s.jsx("div",{className:"max-w-4xl mx-auto",children:s.jsxs("div",{className:"text-center space-y-6",children:[s.jsx("div",{className:"text-6xl",children:"🎵"}),s.jsx("h1",{className:"text-3xl font-bold text-red-400",children:"לא ניתן להתחבר לשרת"}),s.jsx("p",{className:"text-gray-300 text-lg",children:"השרת לא זמין כרגע. אנא נסה שוב מאוחר יותר או פנה לתמיכה."}),oe&&s.jsx("div",{className:"bg-red-900/50 border border-red-500 rounded-lg p-4 max-w-md mx-auto",children:s.jsx("p",{className:"text-red-200",children:oe})}),s.jsx("button",{onClick:be,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"נסה שוב"})]})})});if("checking"===ce)return s.jsx("div",{className:"min-h-screen bg-gray-900 text-white p-6",children:s.jsx("div",{className:"max-w-4xl mx-auto",children:s.jsxs("div",{className:"text-center space-y-6",children:[s.jsx("div",{className:"text-6xl animate-pulse",children:"🎵"}),s.jsx("h1",{className:"text-3xl font-bold",children:"בודק חיבור לשרת..."}),s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"})]})})});const je=()=>M(void 0,null,function*(){console.log("🔍 [AudioSeparation] בודק פרויקטים קיימים...");try{console.log("🔍 [AudioSeparation] שולח בקשה לשרת: GET /api/projects");const e=yield U();console.log("🔍 [AudioSeparation] תשובה מהשרת:",e),e&&e.length>0?(console.log(`🔍 [AudioSeparation] נמצאו ${e.length} פרויקטים בשרת`),h(e),localStorage.setItem("audioSeparationProjects",JSON.stringify(e))):console.log("🔍 [AudioSeparation] לא נמצאו פרויקטים בשרת")}catch(e){console.error("❌ [AudioSeparation] שגיאה בבדיקת פרויקטים קיימים:",e),console.log("🔍 [AudioSeparation] מנסה לטעון פרויקטים מ-localStorage...");const s=localStorage.getItem("audioSeparationProjects");s&&h(JSON.parse(s))}}),be=()=>M(void 0,null,function*(){console.log("🔄 [AudioSeparation] מנסה חיבור מחדש...");try{console.log("🔍 [AudioSeparation] בודק חיבור לשרת...");const e=yield e();console.log("🔍 [AudioSeparation] בדיקת בריאות:",e),e&&"OK"===e.status?(console.log("✅ [AudioSeparation] חיבור לשרת הוחזר"),ie("connected"),yield je()):(console.log("❌ [AudioSeparation] שרת לא מגיב"),ie("disconnected"))}catch(e){console.error("❌ [AudioSeparation] שגיאה בבדיקת חיבור:",e),ie("disconnected")}}),fe=()=>M(void 0,null,function*(){console.log("🔍 [AudioSeparation] בודק חיבור לשרת...");try{console.log("🔍 [AudioSeparation] שולח בדיקת בריאות לשרת...");const e=yield e();console.log("🔍 [AudioSeparation] תשובת בדיקת בריאות:",e),e&&"OK"===e.status?(console.log("✅ [AudioSeparation] שרת מחובר ופעיל"),ie("connected"),yield je()):(console.log("❌ [AudioSeparation] שרת לא מגיב כראוי"),ie("disconnected"))}catch(e){console.error("❌ [AudioSeparation] שגיאה בבדיקת חיבור לשרת:",e),console.log("🔍 [AudioSeparation] פרטי השגיאה:",{message:e.message,stack:e.stack,name:e.name}),ie("disconnected")}});return e.useEffect(()=>{if(Q)try{console.log("📁 ===== טעינה אוטומטית של פרויקטים ====="),console.log("⏰ זמן טעינה:",(new Date).toISOString()),M(void 0,null,function*(){console.log("🔍 [AudioSeparation] מתחיל טעינת פרויקטים...");try{console.log("🔍 [AudioSeparation] בודק פרויקטים ב-localStorage...");const e=localStorage.getItem("audioSeparationProjects");e?(console.log("🔍 [AudioSeparation] נמצאו פרויקטים ב-localStorage:",JSON.parse(e).length),h(JSON.parse(e))):console.log("🔍 [AudioSeparation] לא נמצאו פרויקטים ב-localStorage"),console.log("🔍 [AudioSeparation] מנסה לטעון פרויקטים מהשרת...");const s=yield U();console.log("🔍 [AudioSeparation] תשובה מהשרת:",s),s&&s.length>0?(console.log("🔍 [AudioSeparation] נמצאו פרויקטים בשרת:",s.length),h(s),localStorage.setItem("audioSeparationProjects",JSON.stringify(s))):console.log("🔍 [AudioSeparation] לא נמצאו פרויקטים בשרת")}catch(e){console.error("❌ [AudioSeparation] שגיאה בטעינת פרויקטים:",e),console.log("🔍 [AudioSeparation] מנסה לטעון פרויקטים מ-localStorage בלבד...");const s=localStorage.getItem("audioSeparationProjects");s&&h(JSON.parse(s))}}),setTimeout(()=>{console.log("🔍 ===== בדיקה אוטומטית של פרויקטים קיימים ====="),je()},3e3)}catch(e){console.error("❌ שגיאה בטעינת פרויקטים:",e),se("שגיאה בטעינת פרויקטים - נסה לרענן את הדף")}},[Q]),s.jsxs("div",{className:"min-h-screen bg-gray-900 text-white",children:[s.jsx("div",{className:"bg-gray-800 border-b border-gray-700",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(o,{className:"w-8 h-8 text-purple-400"}),s.jsx("h1",{className:"text-xl font-bold",children:"הפרדת אודיו מתקדמת"})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:["connected"===ce?s.jsx(t,{className:"w-5 h-5 text-green-400"}):s.jsx(r,{className:"w-5 h-5 text-red-400"}),s.jsx("span",{className:"text-sm text-gray-300",children:"connected"===ce?"מחובר":"מנותק"})]}),"studio"===V&&s.jsx("button",{onClick:he,className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors",children:"פרויקט חדש"})]})]})})}),s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:"upload"===V?s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"text-center space-y-4",children:[s.jsx("div",{className:"text-6xl",children:"🎵"}),s.jsx("h2",{className:"text-3xl font-bold text-white",children:"הפרדת אודיו מתקדמת עם AI"}),s.jsx("p",{className:"text-xl text-gray-300 max-w-2xl mx-auto",children:"הפרד את האודיו שלך ל-5 ערוצים נפרדים: ווקאל, בס, תופים, כלי נגינה ואחר"})]}),!u&&s.jsx("div",{className:"max-w-2xl mx-auto",children:s.jsx(z,{onFileSelect:xe,disabled:u})}),u&&s.jsxs("div",{className:"max-w-2xl mx-auto",children:[console.log("🔄 מציג מסך התקדמות - isProcessing:",u,"step:",_,"progress:",g),s.jsx(J,{step:_,progress:g,error:ee,fileName:(null==n?void 0:n.name)||(null==K?void 0:K.name),onCancel:me,onRetry:j&&j.id?()=>retrySpecificProject(j.id):ge})]}),ee&&s.jsx("div",{className:"max-w-2xl mx-auto",children:s.jsxs("div",{className:"bg-red-900/50 border border-red-500 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx(l,{className:"w-5 h-5 text-red-400"}),s.jsx("span",{className:"text-red-200",children:ee})]}),s.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[s.jsxs("button",{onClick:je,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{children:"בדוק פרויקטים קיימים"})]}),j&&j.id&&s.jsxs("button",{onClick:()=>retrySpecificProject(j.id),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{children:"נסה לטעון שוב"})]})]})]})}),!u&&p.length>0&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-xl font-semibold text-center",children:"פרויקטים קיימים"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(e=>s.jsx(Z,{project:e,onSelect:()=>ue(e.id),onDelete:()=>(e=>M(void 0,null,function*(){console.log(`🗑️ [AudioSeparation] מוחק פרויקט: ${e}`);try{console.log(`🔍 [AudioSeparation] שולח בקשה מחיקה לשרת: DELETE /api/projects/${e}`),yield(s=e,M(void 0,null,function*(){console.log(`🗑️ [API] מוחק פרויקט: id=${s}`);try{const e=performance.now(),o=yield D(`/api/projects/${s}`,{method:"DELETE"}),t=performance.now()-e;return console.log(`🗑️ [API] פרויקט נמחק ב: ${t.toFixed(0)}ms`),console.log("🗑️ [API] תוצאת מחיקה:",o),o}catch(e){throw console.error(`❌ [API] שגיאה במחיקת פרויקט ${s}:`,e),e}})),console.log("🔍 [AudioSeparation] פרויקט נמחק מהשרת בהצלחה"),h(s=>s.filter(s=>s.id!==e)),(null==j?void 0:j.id)===e&&(b(null),G("upload"));const o=JSON.parse(localStorage.getItem("audioSeparationProjects")||"[]").filter(s=>s.id!==e);localStorage.setItem("audioSeparationProjects",JSON.stringify(o)),console.log("🔍 [AudioSeparation] פרויקט נמחק מ-localStorage")}catch(o){console.error(`❌ [AudioSeparation] שגיאה במחיקת פרויקט ${e}:`,o),console.log("🔍 [AudioSeparation] מנסה למחוק מ-localStorage בלבד..."),h(s=>s.filter(s=>s.id!==e)),(null==j?void 0:j.id)===e&&(b(null),G("upload"));const s=JSON.parse(localStorage.getItem("audioSeparationProjects")||"[]").filter(s=>s.id!==e);localStorage.setItem("audioSeparationProjects",JSON.stringify(s))}var s}))(e.id)},e.id))})]})]}):s.jsxs("div",{className:"space-y-8",children:[console.log("🔄 מציג מסך סטודיו - currentView:",V),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold",children:"סטודיו אודיו"}),j&&s.jsxs("p",{className:"text-gray-400",children:["פרויקט: ",j.name]})]}),s.jsx("button",{onClick:he,className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors",children:"פרויקט חדש"})]}),Object.keys(f).length>0?s.jsx("div",{className:"space-y-6",children:Object.entries(f).map(([e,o])=>s.jsx(T,{trackId:e,trackData:o,isPlaying:N===e,volume:C[e]||1,isMuted:R[e]||!1,onPlay:()=>(e=>{try{if(N===e)S[e]&&(S[e].pause(),S[e].currentTime=0),v(null);else if(pe(),f[e]){const s=new Audio(f[e].url);s.volume=C[e]||1,s.muted=R[e]||!1,s.addEventListener("ended",()=>v(null)),s.addEventListener("timeupdate",()=>P(s.currentTime)),s.addEventListener("loadedmetadata",()=>I(s.duration)),s.play(),w(o=>E(O({},o),{[e]:s})),v(e)}}catch(s){console.error("❌ שגיאה בהפעלת ערוץ:",s),se("שגיאה בהפעלת ערוץ - נסה שוב")}})(e),onVolumeChange:s=>((e,s)=>{try{k(o=>E(O({},o),{[e]:s})),S[e]&&(S[e].volume=s)}catch(o){console.error("❌ שגיאה בעדכון עוצמת ערוץ:",o)}})(e,s),onMuteToggle:()=>(e=>{try{B(s=>E(O({},s),{[e]:!s[e]})),S[e]&&(S[e].muted=!R[e])}catch(s){console.error("❌ שגיאה בעדכון השתקת ערוץ:",s)}})(e),onDownload:()=>((e,s)=>M(void 0,null,function*(){try{console.log("📥 מוריד ערוץ:",s,"מפרויקט:",e);const r=yield(o=e,t=s,M(void 0,null,function*(){console.log(`⬇️ [API] מוריד stem: projectId=${o}, stemName=${t}`);try{const e=performance.now(),s=yield fetch(`${L()}/api/projects/${o}/download/${t}`),r=performance.now()-e;if(console.log(`⬇️ [API] הורדה הושלמה ב: ${r.toFixed(0)}ms`),console.log(`⬇️ [API] סטטוס הורדה: ${s.status} ${s.statusText}`),!s.ok){const e=yield s.text();throw console.error(`❌ [API] שגיאה בהורדה: ${s.status} ${s.statusText}`),console.error("❌ [API] תוכן שגיאה:",e),new Error(`הורדה נכשלה: ${s.status} ${s.statusText}`)}const l=yield s.blob();return console.log(`✅ [API] stem הורד בהצלחה, גודל: ${l.size} bytes`),l}catch(e){throw console.error("❌ [API] שגיאה בהורדת stem:",e),e}}));if(!r||!r.url)throw new Error("לא התקבל קישור הורדה מהשרת");{const o=document.createElement("a");o.href=r.url,o.download=`${s}_${e}.wav`,document.body.appendChild(o),o.click(),document.body.removeChild(o),console.log("✅ ערוץ הורד בהצלחה")}}catch(r){console.error("❌ שגיאה בהורדת ערוץ:",r);let e=r.message;r.message.includes("timeout")?e="הורדת ערוץ נכשלה - זמן המתנה ארוך מדי":r.message.includes("Failed to fetch")?e="לא ניתן להתחבר לשרת - בדוק את החיבור לאינטרנט":r.message.includes("NetworkError")?e="שגיאת רשת - בדוק את החיבור לאינטרנט":r.message.includes("404")?e="הערוץ לא נמצא - ייתכן שהפרויקט לא הושלם עדיין":r.message.includes("403")?e="אין לך הרשאה להוריד ערוץ זה":r.message.includes("500")?e="שגיאת שרת - נסה שוב מאוחר יותר":r.message.includes("503")&&(e="השרת לא זמין כרגע - נסה שוב מאוחר יותר"),se(e)}var o,t}))(j.id,e)},e))}):u?s.jsx("div",{className:"max-w-2xl mx-auto",children:s.jsx(J,{step:_,progress:g,error:ee,fileName:(null==n?void 0:n.name)||(null==K?void 0:K.name),onCancel:me,onRetry:j&&j.id?()=>retrySpecificProject(j.id):ge})}):s.jsx(F,{})]})})]})};export{R as default};
//# sourceMappingURL=AudioSeparation-8d7d6840-399e3c47.js.map
