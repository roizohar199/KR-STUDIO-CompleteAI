var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,i=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&r(e,s,t[s]);if(a)for(var s of a(t))l.call(t,s)&&r(e,s,t[s]);return e},o=(e,a)=>t(e,s(a)),c=(e,t,s)=>new Promise((a,n)=>{var l=e=>{try{i(s.next(e))}catch(t){n(t)}},r=e=>{try{i(s.throw(e))}catch(t){n(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,r);i((s=s.apply(e,t)).next())});import{j as d}from"./index-2831a802.js";import{r as m}from"./vendor-ed70b211.js";import{C as h,a as u}from"./card-5a73608a.js";import{B as g}from"./button-04768ca5.js";import{t as p,r as x,d as y,m as f,a as b}from"./register_all_kernels-6e0b897e.js";import{LucideMic as w,LucideStar as N,Award as j,Crown as v,Activity as A,Brain as M,LucideSettings as C,LucideMusic as R,LucideVolume2 as S,LucideRadio as F,LucideWaves as q,Clock as P,LucideZap as T,LucideSpeaker as D,Drumstick as k,ExternalLink as I,BarChart3 as L,LucideTrendingUp as z,LucideSparkles as B,LucideTarget as $,Bot as O,Cpu as Y,LucideUpload as E}from"./icons-3130b023.js";class H{constructor(){this.model=null,this.classNames=null,this.isLoaded=!1,this.audioContext=null,this.analyser=null,this.sampleRate=16e3}loadModel(){return c(this,null,function*(){try{return console.log("טוען מודל YAMNet..."),this.classNames=["Speech","Music","Noise","Silence","Male speech","Female speech","Child speech","Conversation","Chorus","Music","Musical instrument","Guitar","Piano","Drum","Violin","Trumpet","Saxophone","Clarinet","Flute","Harmonica","Accordion","Harmonica","Oboe","Cello","Violin","Double bass","Clarinet","Saxophone","Trumpet","Trombone","French horn","Tuba","Percussion","Drum kit","Snare drum","Bass drum","Hi-hat","Cymbal","Tom-tom","Conga","Bongo","Timpani","Xylophone","Marimba","Vibraphone","Glockenspiel","Chimes","Triangle","Tambourine","Cowbell","Wood block","Claves","Guiro","Maracas","Shaker","Cabasa","Rain stick","Ocean drum","Thunder sheet","Wind chimes","Bell tree","Finger cymbals","Sleigh bells","Jingle bells","Sleigh bells","Jingle bells","Sleigh bells","Jingle bells","Sleigh bells","Jingle bells","Sleigh bells"],this.model={predict:e=>c(this,null,function*(){try{const t=(yield e.array())[0],s=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length),a=t.reduce((e,s,a)=>a>0&&(s>=0&&t[a-1]<0||s<0&&t[a-1]>=0)?e+1:e,0),n=new Array(this.classNames.length).fill(0);s>.05&&s<.3&&a>30&&a<300?(n[0]=.9,n[4]=.8,n[5]=.7,n[1]=.6,n[10]=.5):s>.1&&a>100&&(n[1]=.8,n[10]=.6),s>.15&&n[0]<.5&&(a>150?(n[12]=.7,n[13]=.6):a>80?(n[14]=.8,n[35]=.7):(n[15]=.6,n[16]=.5)),s>.2&&a<50&&n[0]<.3&&(n[12]=.6),s<.01?n[3]=.9:s>.3&&(n[2]=.8);const l=Math.max(...n);if(l>0)for(let e=0;e<n.length;e++)n[e]=n[e]/l;return p([n])}catch(t){console.error("שגיאה בחיזוי:",t);const s=e.shape[0],a=this.classNames.length;return x([s,a])}})},this.isLoaded=!0,console.log("YAMNet נטען בהצלחה! (גרסה מודגמת)"),!0}catch(e){return console.error("שגיאה בטעינת YAMNet:",e),!1}})}initializeAudio(){return c(this,null,function*(){try{return this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,!0}catch(e){return console.error("שגיאה באתחול AudioContext:",e),!1}})}preprocessAudio(e){const t=e.sampleRate,s=e.getChannelData(0);let a;a=t!==this.sampleRate?this.resample(s,t,this.sampleRate):s;const n=p(a);return y(n,f(b(n)))}resample(e,t,s){const a=t/s,n=Math.round(e.length/a),l=new Float32Array(n);for(let r=0;r<n;r++){const t=Math.round(r*a);l[r]=e[t]||0}return l}analyzeWithYAMNet(e){return c(this,null,function*(){if(!this.isLoaded){if(!(yield this.loadModel()))return null}try{const t=this.preprocessAudio(e),s=yield this.model.predict(t.expandDims(0)),a=yield s.array(),n=this.getTopPredictions(a[0],10);return t.dispose(),s.dispose(),{predictions:n,rawScores:a[0],confidence:Math.max(...a[0])}}catch(t){return console.error("שגיאה בניתוח YAMNet:",t),null}})}getTopPredictions(e,t=10){const s=e.map((e,t)=>({score:e,index:t}));return s.sort((e,t)=>t.score-e.score),s.slice(0,t).map(e=>({className:this.classNames[e.index],score:e.score,confidence:(100*e.score).toFixed(2)+"%"}))}startRealTimeAnalysis(e){return c(this,null,function*(){if(!this.isLoaded){if(!(yield this.loadModel()))return!1}if(!this.audioContext){if(!(yield this.initializeAudio()))return!1}try{const t=yield navigator.mediaDevices.getUserMedia({audio:!0});this.audioContext.createMediaStreamSource(t).connect(this.analyser);const s=this.analyser.frequencyBinCount,a=new Float32Array(s),n=()=>c(this,null,function*(){this.analyser.getFloatTimeDomainData(a);const t=p(a),s=y(t,f(b(t))),l=yield this.model.predict(s.expandDims(0)),r=yield l.array(),i=this.getTopPredictions(r[0],5);t.dispose(),s.dispose(),l.dispose(),e(i),requestAnimationFrame(n)});return n(),!0}catch(t){return console.error("שגיאה באנליזה בזמן אמת:",t),!1}})}stopRealTimeAnalysis(){this.audioContext&&(this.audioContext.close(),this.audioContext=null)}getInstrumentAnalysis(e){const t={vocals:["Voice","Singing","Speech","Male","Female","Chorus"],drums:["Drum","Snare","Kick","Hi-hat","Cymbal","Tom"],bass:["Bass","Electric bass","Acoustic bass"],guitar:["Guitar","Electric guitar","Acoustic guitar"],piano:["Piano","Keyboard","Organ"],strings:["Violin","Cello","String"],brass:["Trumpet","Saxophone","Trombone"],woodwind:["Flute","Clarinet","Oboe"]},s={};for(const[a,n]of Object.entries(t))s[a]=e.filter(e=>n.some(t=>e.className.toLowerCase().includes(t.toLowerCase())));if(s.vocals.length>0){if(Math.max(...s.vocals.map(e=>e.score||0))>.5)for(const[e,t]of Object.entries(s))"vocals"!==e&&(s[e]=t.map(e=>o(i({},e),{score:.3*e.score})))}return s}getGenreAnalysis(e){const t={rock:["Rock","Guitar","Electric"],jazz:["Jazz","Saxophone","Trumpet"],classical:["Classical","Orchestra","Violin"],electronic:["Electronic","Synthesizer","Drum machine"],pop:["Pop","Voice","Singing"],hiphop:["Hip hop","Rap","Beat"],country:["Country","Acoustic"],blues:["Blues","Harmonica"]},s={};for(const[a,n]of Object.entries(t))s[a]=e.filter(e=>n.some(t=>e.className.toLowerCase().includes(t.toLowerCase())));return s}getProductionRecommendations(e){const t={compression:[],eq:[],reverb:[],delay:[],saturation:[]};e.filter(e=>e.className.toLowerCase().includes("drum")||e.className.toLowerCase().includes("snare")||e.className.toLowerCase().includes("kick")).length>0&&t.compression.push({name:"Waves SSL G-Comp",reason:"קומפרסור קלאסי לתופים עם אופי SSL",settings:{Attack:"30ms",Release:"100ms",Ratio:"2:1"}});e.filter(e=>e.className.toLowerCase().includes("voice")||e.className.toLowerCase().includes("singing")||e.className.toLowerCase().includes("speech")||e.className.toLowerCase().includes("male")||e.className.toLowerCase().includes("female")).length>0&&(t.eq.push({name:"FabFilter Pro-Q3",reason:"איקיו מדויק לווקאלים",settings:{"High Pass":"80Hz",Presence:"+3dB",Air:"+2dB"}}),t.compression.push({name:"Waves CLA-2A",reason:"קומפרסור אנלוגי לווקאלים",settings:{Attack:"10ms",Release:"100ms",Ratio:"3:1"}}),t.reverb.push({name:"Valhalla Room",reason:"ריברב טבעי לווקאלים",settings:{Size:"Medium",Decay:"1.5s",Mix:"15%"}}),t.saturation.push({name:"Soundtoys Decapitator",reason:"סאטורציה חמה לווקאלים",settings:{Drive:"2dB",Style:"A",Mix:"20%"}}));return e.filter(e=>e.className.toLowerCase().includes("bass")).length>0&&t.compression.push({name:"Waves CLA-76",reason:"קומפרסור אנלוגי לבס",settings:{Attack:"20ms",Release:"200ms",Ratio:"4:1"}}),t}}const G=new class{constructor(){this.baseURL="https://api.openai.com/v1",this.cache=new Map,this.requestQueue=new Map,this.maxRetries=3,this.retryDelay=1e3}getCacheKey(e,t){return`${e}:${JSON.stringify(t)}`}getFromCache(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<3e5?t.data:null}setCache(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}makeRequest(e){return c(this,arguments,function*(e,t={},s=!0){const a=this.getCacheKey(e,t);if(this.requestQueue.has(a))return this.requestQueue.get(a);if(s){const t=this.getFromCache(a);if(t)return console.log("📦 מחזיר מ-cache:",e),t}const n=this._executeRequest(e,t,a);this.requestQueue.set(a,n);try{const e=yield n;return s&&this.setCache(a,e),e}finally{this.requestQueue.delete(a)}})}_executeRequest(e,t,s){return c(this,null,function*(){let s;for(let n=1;n<=this.maxRetries;n++)try{const s=`${this.baseURL}${e}`,a=i({method:t.method||"GET",headers:i({"Content-Type":"application/json"},t.headers)},t);t.body&&(a.body=JSON.stringify(t.body)),console.log(`🚀 ניסיון ${n}/${this.maxRetries}:`,e);const l=yield fetch(s,a);if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);const r=yield l.json();return console.log("✅ הצלחה:",e),r}catch(a){s=a,console.warn(`⚠️ ניסיון ${n} נכשל:`,a.message),n<this.maxRetries&&(yield new Promise(e=>setTimeout(e,this.retryDelay*n)))}throw new Error(`כל הניסיונות נכשלו: ${s.message}`)})}separateAudio(e){return c(this,arguments,function*(e,t={}){const s=new FormData;return s.append("audio",e),t.model&&s.append("model",t.model),t.stems&&s.append("stems",t.stems),this.makeRequest("/separate",{method:"POST",body:s,headers:{}},!1)})}getSeparationStatus(e){return c(this,null,function*(){return this.makeRequest(`/status/${e}`)})}getProjectFiles(e){return c(this,null,function*(){return this.makeRequest(`/files/${e}`)})}getProductionRecommendations(e){return c(this,null,function*(){return this.makeRequest("/recommendations",{method:"POST",body:e})})}exportVersions(e,t="wav"){return c(this,null,function*(){return this.makeRequest(`/export/${e}`,{method:"POST",body:{format:t}},!1)})}clearCache(){this.cache.clear(),console.log("🧹 Cache נוקה")}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}};class V{constructor(){this.audioContext=null,this.sampleRate=44100,this.minTempo=60,this.maxTempo=200,this.tempoCandidates=[],this.beatMap=[],this.confidence=0}initialize(){return c(this,null,function*(){try{return this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.sampleRate=this.audioContext.sampleRate,console.log("🎵 מערכת ניתוח טמפו מתקדמת אותחלה"),!0}catch(e){return console.error("❌ שגיאה באתחול מערכת ניתוח טמפו:",e),!1}})}analyzeTempoAdvanced(e){return c(this,null,function*(){console.log("🎵 מתחיל ניתוח טמפו מתקדם...");const t={primaryTempo:120,confidence:0,beatMap:[],timeSignature:{numerator:4,denominator:4},groove:{swing:0,regularity:0},analysis:{autocorrelation:null,spectralFlux:null,onsetDetection:null,beatTracking:null}};try{const s=this.performAdvancedAutocorrelation(e);t.analysis.autocorrelation=s;const a=this.performOnsetDetection(e);t.analysis.onsetDetection=a;const n=this.performSpectralFluxAnalysis(e);t.analysis.spectralFlux=n;const l=this.performAdvancedBeatTracking(e);t.analysis.beatTracking=l;const r=this.combineTempoResults([s,a,n,l]);return t.primaryTempo=r.tempo,t.confidence=r.confidence,t.beatMap=r.beatMap,t.groove=r.groove,console.log("✅ ניתוח טמפו מתקדם הושלם:",{tempo:t.primaryTempo,confidence:t.confidence,beatCount:t.beatMap.length}),t}catch(s){return console.error("❌ שגיאה בניתוח טמפו מתקדם:",s),t}})}performAdvancedAutocorrelation(e){const t=e.getChannelData(0),s=Math.floor(.1*this.sampleRate),a=Math.floor(s/2),n=[];for(let r=0;r<t.length-s;r+=a){const e=t.slice(r,r+s);n.push(e)}const l=n.map(e=>this.calculateAutocorrelation(e));return{method:"autocorrelation",tempoCandidates:this.findTempoCandidates(l),confidence:this.calculateConfidence(l),rhythmPatterns:this.extractRhythmPatterns(l)}}calculateAutocorrelation(e){const t=e.length,s=new Float32Array(t);for(let a=0;a<t;a++){let n=0;for(let s=0;s<t-a;s++)n+=e[s]*e[s+a];s[a]=n/(t-a)}return s}performOnsetDetection(e){const t=e.getChannelData(0),s=Math.floor(.023*this.sampleRate),a=Math.floor(s/2),n=[],l=[];for(let r=0;r<t.length-s;r+=a){const e=t.slice(r,r+s),i=this.calculateSpectrum(e);if(r>0){const e=t.slice(r-a,r-a+s),o=this.calculateSpectrum(e),c=this.calculateSpectralFlux(o,i);l.push(c),c>this.calculateOnsetThreshold(l)&&n.push(r/this.sampleRate)}}return{method:"onset_detection",onsets:n,onsetStrengths:l,tempoEstimate:this.estimateTempoFromOnsets(n),confidence:this.calculateOnsetConfidence(n,l)}}calculateSpectrum(e){return new W(e.length).forward(e)}calculateSpectralFlux(e,t){let s=0;for(let a=0;a<e.length;a++){const n=t[a]-e[a];s+=Math.max(0,n)}return s}performSpectralFluxAnalysis(e){const t=e.getChannelData(0),s=Math.floor(.046*this.sampleRate),a=Math.floor(s/2),n=[],l=[];for(let r=0;r<t.length-s;r+=a){const e=t.slice(r,r+s),i=this.calculateSpectrum(e);if(r>0){const e=t.slice(r-a,r-a+s),o=this.calculateSpectrum(e),c=this.calculateSpectralFlux(o,i);n.push(c),this.isPeak(n,n.length-1)&&l.push(r/this.sampleRate)}}return{method:"spectral_flux",fluxValues:n,peaks:l,tempoEstimate:this.estimateTempoFromPeaks(l),confidence:this.calculateFluxConfidence(n)}}performAdvancedBeatTracking(e){const t=e.getChannelData(0),s=Math.floor(.1*this.sampleRate),a=Math.floor(s/2),n=[],l=[];for(let r=0;r<t.length-s;r+=a){const e=t.slice(r,r+s),a=this.extractBeatFeatures(e),i=this.calculateBeatProbability(a);n.push(i),i>this.calculateBeatThreshold(n)&&l.push(r/this.sampleRate)}return{method:"beat_tracking",beats:l,beatProbabilities:n,tempoEstimate:this.estimateTempoFromBeats(l),confidence:this.calculateBeatConfidence(l,n)}}extractBeatFeatures(e){return{energy:this.calculateEnergy(e),spectralCentroid:this.calculateSpectralCentroid(e),spectralRolloff:this.calculateSpectralRolloff(e),zeroCrossingRate:this.calculateZeroCrossingRate(e),mfcc:this.calculateMFCC(e)}}calculateBeatProbability(e){return.4*e.energy+.3*((e.spectralCentroid+e.spectralRolloff)/2)+.3*(e.mfcc.reduce((e,t)=>e+Math.abs(t),0)/e.mfcc.length)}combineTempoResults(e){const t=[],s=[],a=[];e.forEach(e=>{e.tempoEstimate&&e.confidence&&(t.push(e.tempoEstimate),s.push(e.confidence)),e.beats&&a.push(...e.beats)});const n=this.calculateWeightedTempo(t,s),l=this.calculateAverageConfidence(s),r=this.mergeBeatMaps(a);return{tempo:n,confidence:l,beatMap:r,groove:this.calculateGroove(r)}}calculateWeightedTempo(e,t){if(0===e.length)return 120;let s=0,a=0;for(let n=0;n<e.length;n++)s+=e[n]*t[n],a+=t[n];return a>0?s/a:120}calculateGroove(e){if(e.length<2)return{swing:0,regularity:0};const t=[];for(let l=1;l<e.length;l++)t.push(e[l]-e[l-1]);const s=t.reduce((e,t)=>e+t,0)/t.length,a=t.reduce((e,t)=>e+Math.pow(t-s,2),0)/t.length,n=Math.max(0,1-Math.sqrt(a)/s);return{swing:this.calculateSwing(t),regularity:n}}calculateSwing(e){if(e.length<2)return 0;let t=0;for(let s=0;s<e.length-1;s+=2)if(s+1<e.length){const a=e[s+1]/e[s];t+=Math.abs(a-1)}return Math.min(1,t/Math.floor(e.length/2))}findTempoCandidates(e){const t=[],s=Math.floor(this.sampleRate/this.maxTempo),a=Math.floor(this.sampleRate/this.minTempo);return e.forEach(e=>{for(let n=s;n<a;n++)if(this.isPeak(e,n)){const e=60/(n/this.sampleRate);t.push(e)}}),this.clusterTempoCandidates(t)}clusterTempoCandidates(e){const t=[];return e.forEach(e=>{let s=!1;for(let a of t)if(Math.abs(a.tempo-e)<2){a.count++,a.tempo=(a.tempo+e)/2,s=!0;break}s||t.push({tempo:e,count:1})}),t.sort((e,t)=>t.count-e.count)}isPeak(e,t){return!(t<=0||t>=e.length-1)&&(e[t]>e[t-1]&&e[t]>e[t+1])}calculateConfidence(e){const t=e.map(e=>e.confidence||0);return t.reduce((e,t)=>e+t,0)/t.length}extractRhythmPatterns(e){const t=[];return e.forEach(e=>{const s=[];for(let t=0;t<e.length;t++)this.isPeak(e,t)&&s.push(t);t.push(s)}),t}estimateTempoFromOnsets(e){if(e.length<2)return 120;const t=[];for(let s=1;s<e.length;s++)t.push(e[s]-e[s-1]);return 60/(t.reduce((e,t)=>e+t,0)/t.length)}calculateOnsetThreshold(e){if(0===e.length)return 0;const t=e.reduce((e,t)=>e+t,0)/e.length,s=Math.sqrt(e.reduce((e,s)=>e+Math.pow(s-t,2),0)/e.length);return t+1.5*s}calculateOnsetConfidence(e,t){if(0===e.length)return 0;return(t.reduce((e,t)=>e+t,0)/t.length+this.calculateRegularity(e))/2}estimateTempoFromPeaks(e){if(e.length<2)return 120;const t=[];for(let s=1;s<e.length;s++)t.push(e[s]-e[s-1]);return 60/(t.reduce((e,t)=>e+t,0)/t.length)}calculateFluxConfidence(e){if(0===e.length)return 0;const t=e.reduce((e,t)=>e+t,0)/e.length,s=e.reduce((e,s)=>e+Math.pow(s-t,2),0)/e.length;return Math.max(0,1-Math.sqrt(s)/t)}estimateTempoFromBeats(e){if(e.length<2)return 120;const t=[];for(let s=1;s<e.length;s++)t.push(e[s]-e[s-1]);return 60/(t.reduce((e,t)=>e+t,0)/t.length)}calculateBeatThreshold(e){if(0===e.length)return 0;const t=e.reduce((e,t)=>e+t,0)/e.length,s=Math.sqrt(e.reduce((e,s)=>e+Math.pow(s-t,2),0)/e.length);return t+s}calculateBeatConfidence(e,t){if(0===e.length)return 0;return(t.reduce((e,t)=>e+t,0)/t.length+this.calculateRegularity(e))/2}calculateRegularity(e){if(e.length<2)return 0;const t=[];for(let n=1;n<e.length;n++)t.push(e[n]-e[n-1]);const s=t.reduce((e,t)=>e+t,0)/t.length,a=t.reduce((e,t)=>e+Math.pow(t-s,2),0)/t.length;return Math.max(0,1-Math.sqrt(a)/s)}calculateAverageConfidence(e){return 0===e.length?0:e.reduce((e,t)=>e+t,0)/e.length}mergeBeatMaps(e){return[...new Set(e)].sort((e,t)=>e-t)}calculateEnergy(e){return e.reduce((e,t)=>e+t*t,0)/e.length}calculateSpectralCentroid(e){const t=this.calculateSpectrum(e);let s=0,a=0;for(let n=0;n<t.length;n++){s+=n*this.sampleRate/(2*t.length)*t[n],a+=t[n]}return a>0?s/a:0}calculateSpectralRolloff(e){const t=this.calculateSpectrum(e);let s=0;const a=t.reduce((e,t)=>e+t,0);for(let n=0;n<t.length;n++)if(s+=t[n],s/a>=.85)return n/t.length;return 1}calculateZeroCrossingRate(e){let t=0;for(let s=1;s<e.length;s++)(e[s]>=0&&e[s-1]<0||e[s]<0&&e[s-1]>=0)&&t++;return t/e.length}calculateMFCC(e){const t=this.calculateSpectrum(e),s=this.applyMelFilterbank(t);return this.applyDCT(s).slice(0,13)}applyMelFilterbank(e){const t=new Array(26).fill(0);for(let s=0;s<26;s++)for(let a=0;a<e.length;a++){const n=this.createMelFilter(a,s,e.length);t[s]+=e[a]*n}return t}createMelFilter(e,t,s){const a=this.melToFreq(2595*t/26),n=e*this.sampleRate/(2*s),l=Math.abs(n-a);return Math.max(0,1-l/(.5*a))}melToFreq(e){return 700*(Math.pow(10,e/2595)-1)}applyDCT(e){const t=e.length,s=new Array(t).fill(0);for(let a=0;a<t;a++)for(let n=0;n<t;n++)s[a]+=e[n]*Math.cos(Math.PI*a*(2*n+1)/(2*t));return s}}let W=class{constructor(e){this.size=e}forward(e){const t=new Float32Array(this.size),s=new Float32Array(this.size);for(let n=0;n<this.size;n++)t[n]=e[n]||0,s[n]=0;this.fft(t,s);const a=new Float32Array(this.size/2);for(let n=0;n<this.size/2;n++)a[n]=Math.sqrt(t[n]*t[n]+s[n]*s[n]);return a}fft(e,t){const s=e.length;if(s<=1)return;const a=new Float32Array(s/2),n=new Float32Array(s/2),l=new Float32Array(s/2),r=new Float32Array(s/2);for(let i=0;i<s/2;i++)a[i]=e[2*i],n[i]=t[2*i],l[i]=e[2*i+1],r[i]=t[2*i+1];this.fft(a,n),this.fft(l,r);for(let i=0;i<s/2;i++){const o=-2*Math.PI*i/s,c=Math.cos(o),d=Math.sin(o),m=c*l[i]-d*r[i],h=d*l[i]+c*r[i];e[i]=a[i]+m,t[i]=n[i]+h,e[i+s/2]=a[i]-m,t[i+s/2]=n[i]-h}}};class Q{constructor(){this.audioContext=null,this.analyser=null,this.dataArray=null,this.isAnalyzing=!1,this.yamnetAnalyzer=new H,this.yamnetLoaded=!1,this.tempoAnalyzer=new V,this.allPluginsMap=this.createAllPluginsMap()}createAllPluginsMap(){const e={};return Object.keys(X).forEach(t=>{Object.keys(X[t]).forEach(s=>{X[t][s].forEach(a=>{const n=`${a.name}_${s}`;e[n]=o(i({},a),{sourceStemType:t,sourceCategory:s})})})}),e}findPluginByName(e,t){const s=`${e}_${t}`;return this.allPluginsMap[s]||null}findAlternativePlugin(e,t){return X[t]&&X[t][e]?X[t][e][0]:this.findGeneralPlugin(e)}findGeneralPlugin(e){for(const t of Object.keys(X))if(X[t][e])return X[t][e][0];return null}initializeAudioContext(){return c(this,null,function*(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048;const e=this.analyser.frequencyBinCount;return this.dataArray=new Uint8Array(e),!0}catch(e){return console.error("שגיאה באתחול AudioContext:",e),!1}})}analyzeAudioFile(e){return c(this,null,function*(){if(!this.audioContext){if(!(yield this.initializeAudioContext()))return null}try{const t=yield e.arrayBuffer(),s=yield this.audioContext.decodeAudioData(t);yield this.tempoAnalyzer.initialize();const a=yield this.tempoAnalyzer.analyzeTempoAdvanced(s),n=yield this.performYAMNetAnalysis(s),l=this.performDeepAnalysis(s);return this.combineAnalyses(l,n,a)}catch(t){return console.error("שגיאה בניתוח הקובץ:",t),null}})}performYAMNetAnalysis(e){return c(this,null,function*(){try{if(!this.yamnetLoaded&&(console.log("טוען YAMNet..."),this.yamnetLoaded=yield this.yamnetAnalyzer.loadModel(),!this.yamnetLoaded))return console.warn("YAMNet לא נטען, ממשיך עם ניתוח מסורתי בלבד"),null;const t=yield this.yamnetAnalyzer.analyzeWithYAMNet(e);return t?{yamnetPredictions:t.predictions,instrumentAnalysis:this.yamnetAnalyzer.getInstrumentAnalysis(t.predictions),genreAnalysis:this.yamnetAnalyzer.getGenreAnalysis(t.predictions),yamnetRecommendations:this.yamnetAnalyzer.getProductionRecommendations(t.predictions),confidence:t.confidence}:null}catch(t){return console.error("שגיאה בניתוח YAMNet:",t),null}})}combineAnalyses(e,t,s){const a=o(i({},e),{yamnet:t,advancedTempo:s});return t&&t.instrumentAnalysis&&(a.enhancedInstruments=this.enhanceInstrumentDetection(e.instruments,t.instrumentAnalysis)),t&&t.yamnetRecommendations&&(a.enhancedRecommendations=this.enhanceRecommendations(e.recommendations,t.yamnetRecommendations)),s&&(a.enhancedRhythm=o(i({},a.rhythmicAnalysis),{advancedTempo:s.primaryTempo,tempoConfidence:s.confidence,beatMap:s.beatMap,timeSignature:s.timeSignature,groove:s.groove,analysisMethods:s.analysis})),a}enhanceInstrumentDetection(e,t){const s=i({},e);for(const[a,n]of Object.entries(t))if(n.length>0){const e=n.reduce((e,t)=>e+t.score,0)/n.length;s[a]=o(i({},s[a]),{yamnetConfidence:e,yamnetPredictions:n})}return s}enhanceRecommendations(e,t){const s=i({},e);for(const[a,n]of Object.entries(t))n.length>0&&(s[a]=[...s[a]||[],...n.map(e=>o(i({},e),{source:"YAMNet",priority:"high"}))]);return s}performDeepAnalysis(e){const t={frequencyAnalysis:this.analyzeFrequencySpectrum(e),dynamicsAnalysis:this.analyzeDynamics(e),rhythmicAnalysis:this.analyzeRhythm(e),instrumentDetection:this.detectInstruments(e),genreAnalysis:this.analyzeGenre(e),qualityAnalysis:this.analyzeRecordingQuality(e),recommendations:{}};return t.recommendations=this.generatePersonalizedRecommendations(t),t}analyzeFrequencySpectrum(e){const t=e.getChannelData(0),s=new _(2048);s.forward(t);const a=s.spectrum,n=a.slice(0,100).reduce((e,t)=>e+t,0)/100,l=a.slice(100,500).reduce((e,t)=>e+t,0)/400,r=a.slice(500,1e3).reduce((e,t)=>e+t,0)/500;return{lowFreq:n,midFreq:l,highFreq:r,dominantFreq:this.findDominantFrequency(a),frequencyBalance:this.calculateFrequencyBalance(n,l,r)}}analyzeDynamics(e){const t=e.getChannelData(0),s=this.calculateRMS(t),a=this.calculatePeak(t);return{rms:s,peak:a,dynamicRange:a-s,compression:this.calculateCompressionRatio(a,s),transients:this.detectTransients(t)}}analyzeRhythm(e){const t=e.getChannelData(0);return{tempo:this.detectTempo(t),groove:this.analyzeGroove(t),rhythmicComplexity:this.calculateRhythmicComplexity(t),timing:this.analyzeTiming(t)}}detectInstruments(e){const t=e.getChannelData(0),s=this.extractAudioFeatures(t),a={drums:this.calculateDrumScore(s),bass:this.calculateBassScore(s),guitar:this.calculateGuitarScore(s),piano:this.calculatePianoScore(s),violin:this.calculateViolinScore(s),vocal:this.calculateVocalScore(s)},n=this.getPrimaryInstrument(a);return console.log("=== ניתוח כלי נגינה ==="),console.log("ציונים לכלי נגינה:",a),console.log("כלי ראשי שזוהה:",n),console.log("מאפיינים שחושבו:",s),{primaryInstrument:n,confidence:Math.max(...Object.values(a)),allScores:a}}analyzeGenre(e){const t=e.getChannelData(0),s=this.extractAudioFeatures(t);return{primaryGenre:this.classifyGenre(s),subGenres:this.detectSubGenres(s),mood:this.analyzeMood(s),energy:this.calculateEnergy(s)}}analyzeRecordingQuality(e){const t=e.getChannelData(0);return{noiseFloor:this.calculateNoiseFloor(t),clipping:this.detectClipping(t),phaseIssues:this.detectPhaseIssues(e),sampleRate:e.sampleRate,bitDepth:this.estimateBitDepth(t),overallQuality:this.calculateOverallQuality(t)}}generatePersonalizedRecommendations(e){const t={compression:this.getCompressionRecommendations(e),eq:this.getEQRecommendations(e),reverb:this.getReverbRecommendations(e),delay:this.getDelayRecommendations(e),saturation:this.getSaturationRecommendations(e),additional:this.getAdditionalRecommendations(e)};return Object.keys(t).forEach(s=>{if("additional"!==s&&(!t[s]||0===t[s].length)){const a=this.findAlternativePlugin(s,e.instrumentDetection.primaryInstrument);a&&(t[s]=[o(i({},a),{reason:"המלצה כללית מבוססת ניתוח AI",description:a.description})])}}),t}calculateRMS(e){let t=0;for(let s=0;s<e.length;s++)t+=e[s]*e[s];return Math.sqrt(t/e.length)}calculatePeak(e){let t=0;for(let s=0;s<e.length;s++){const a=Math.abs(e[s]);a>t&&(t=a)}return t}calculateCompressionRatio(e,t){return e/(t+1e-4)}detectTransients(e){const t=[];for(let s=1;s<e.length;s++){Math.abs(e[s]-e[s-1])>.1&&t.push(s)}return t}detectTempo(e){const t=this.calculateAutocorrelation(e),s=this.findPeaks(t);return this.calculateTempoFromPeaks(s)}calculateDrumScore(e){return.4*(e.transientDensity||0)+.3*(e.lowFreqEnergy||0)+.3*(e.rhythmicRegularity||0)}calculateBassScore(e){const t=e.lowFreqContent||0,s=e.sustain||0,a=e.harmonicContent||0,n=.5*t+.3*s+.2*a;let l=0;(e.formantStructure||0)>.05&&(l+=.3),(e.breathiness||0)>.02&&(l+=.2);const r=Math.max(0,n-l);return console.log("=== ניקוד בס ==="),console.log("תוכן תדרים נמוכים:",t),console.log("סוסטיין:",s),console.log("תוכן הרמוני:",a),console.log("ציון בסיס:",n),console.log("הפחתה:",l),console.log("ניקוד סופי לבס:",r),r}calculateGuitarScore(e){return.4*(e.midFreqContent||0)+.4*(e.harmonicRichness||0)+.2*(e.transientSharpness||0)}calculatePianoScore(e){const t=e.harmonicComplexity||0,s=e.dynamicRange||0,a=e.sustain||0,n=.5*t+.3*s+.2*a;return console.log("=== ניקוד פסנתר ==="),console.log("מורכבות הרמונית:",t),console.log("טווח דינמי:",s),console.log("סוסטיין:",a),console.log("ניקוד סופי לפסנתר:",n),n}calculateViolinScore(e){return.4*(e.highFreqContent||0)+.3*(e.vibrato||0)+.3*(e.bowing||0)}calculateVocalScore(e){const t=e.formantStructure||0,s=e.breathiness||0,a=e.pitchVariation||0,n=.6*t+.2*s+.15*a+.05*(e.vocalArticulation||0);let l=0;t>.1&&(l+=.2),s>.05&&(l+=.1),a>.1&&(l+=.1);return Math.min(1,n+l)}getPrimaryInstrument(e){const t=e.vocal||0;if(e.bass,e.piano,e.guitar,e.drum,console.log("=== בחירת כלי ראשי ==="),console.log("כל הציונים:",e),t>.1)return console.log("כלי שנבחר: vocal (עדיפות מוחלטת לווקאל)"),console.log("ביטחון בזיהוי:",t),"vocal";const s=Object.keys(e).reduce((t,s)=>e[t]>e[s]?t:s);return console.log("כלי שנבחר:",s),console.log("ביטחון בזיהוי:",e[s]),s}findDominantFrequency(e){let t=0,s=0;for(let a=0;a<e.length;a++)e[a]>s&&(s=e[a],t=a);return t*(this.audioContext.sampleRate/(2*e.length))}calculateFrequencyBalance(e,t,s){const a=e+t+s;if(0===a)return.33;const n=e/a,l=t/a,r=s/a,i=.33,o=1-Math.sqrt(Math.pow(n-i,2)+Math.pow(l-i,2)+Math.pow(r-i,2));return Math.max(0,o)}analyzeGroove(e){const t=this.detectTransients(e),s=[];for(let r=1;r<t.length;r++)s.push(t[r]-t[r-1]);if(0===s.length)return{regularity:0,swing:0};const a=s.reduce((e,t)=>e+t,0)/s.length,n=1/(1+s.reduce((e,t)=>e+Math.pow(t-a,2),0)/s.length),l=[];for(let r=0;r<s.length-1;r+=2)s[r+1]&&l.push(s[r+1]/s[r]);return{regularity:n,swing:l.length>0?l.reduce((e,t)=>e+t,0)/l.length:1}}calculateRhythmicComplexity(e){const t=this.detectTransients(e),s=[];for(let n=1;n<t.length;n++)s.push(t[n]-t[n-1]);if(0===s.length)return 0;const a=[...new Set(s)].length/s.length;return Math.min(1,2*a)}analyzeTiming(e){const t=this.detectTransients(e),s={precision:0,humanization:0,groove:0};if(t.length<2)return s;const a=[];for(let r=1;r<t.length;r++)a.push(t[r]-t[r-1]);const n=a.reduce((e,t)=>e+t,0)/a.length,l=a.reduce((e,t)=>e+Math.pow(t-n,2),0)/a.length;return s.precision=1/(1+l),s.humanization=1-s.precision,s.groove=this.analyzeGroove(e).regularity,s}calculateAutocorrelation(e){const t=Math.min(1e3,Math.floor(e.length/2)),s=new Float32Array(t);for(let a=0;a<t;a++){let t=0;for(let s=0;s<e.length-a;s++)t+=e[s]*e[s+a];s[a]=t/(e.length-a)}return s}findPeaks(e){const t=[];let s=0;for(let n=0;n<e.length;n++)e[n]>s&&(s=e[n]);const a=.5*s;for(let n=1;n<e.length-1;n++)e[n]>a&&e[n]>e[n-1]&&e[n]>e[n+1]&&t.push(n);return t}calculateTempoFromPeaks(e){if(0===e.length)return 120;const t=[];for(let a=1;a<e.length;a++)t.push(e[a]-e[a-1]);if(0===t.length)return 120;const s=60/(t.reduce((e,t)=>e+t,0)/t.length/this.audioContext.sampleRate);return Math.max(60,Math.min(200,s))}classifyGenre(e){const{spectralCentroid:t,spectralRolloff:s,zeroCrossingRate:a}=e;return t>.7&&s>.8?"electronic":t>.6&&a>.3?"rock":t<.4&&s<.6?"jazz":t>.5&&s>.7?"pop":"classical"}detectSubGenres(e){const t=[],{spectralCentroid:s,spectralRolloff:a}=e;return s>.8&&t.push("dance"),a>.9&&t.push("electronic"),s<.3&&t.push("ambient"),t}analyzeMood(e){const{spectralCentroid:t,spectralRolloff:s}=e;return t>.7?s>.8?"energetic":"bright":t<.4?"mellow":"neutral"}calculateEnergy(e){const{spectralCentroid:t,spectralRolloff:s}=e;return(t+s)/2}calculateNoiseFloor(e){const t=[...e].sort((e,t)=>Math.abs(e)-Math.abs(t)),s=t[Math.floor(.1*t.length)];return 20*Math.log10(Math.abs(s)+1e-10)}detectClipping(e){let t=0;for(let s=0;s<e.length;s++)Math.abs(e[s])>.95&&t++;return t/e.length>.01}detectPhaseIssues(e){if(e.numberOfChannels<2)return!1;const t=e.getChannelData(0),s=e.getChannelData(1);let a=0;for(let n=0;n<t.length;n++)a+=t[n]*s[n];return a/=t.length,a<.3}estimateBitDepth(e){let t=0;for(let a=0;a<e.length;a++){const s=Math.abs(e[a]);s>t&&(t=s)}const s=Math.log2(2*t)+1;return Math.round(s)}calculateOverallQuality(e){const t=this.calculateNoiseFloor(e);let s=.5;return this.detectClipping(e)||(s+=.2),this.calculatePeak(e)-Math.abs(t)>40&&(s+=.2),Math.abs(t)<-60&&(s+=.1),Math.min(1,s)}calculateSpectralCentroid(e){const t=new _(2048);t.forward(e);let s=0,a=0;for(let n=0;n<t.spectrum.length;n++)s+=n*t.spectrum[n],a+=t.spectrum[n];return a>0?s/a/t.spectrum.length:.5}calculateSpectralRolloff(e){const t=new _(2048);t.forward(e);let s=0,a=t.spectrum.reduce((e,t)=>e+t,0);for(let n=0;n<t.spectrum.length;n++)if(s+=t.spectrum[n],s/a>=.85)return n/t.spectrum.length;return.8}calculateSpectralFlux(e){const t=new _(2048);t.forward(e);let s=0;const a=new Float32Array(t.spectrum.length);for(let n=0;n<t.spectrum.length;n++)s+=Math.pow(t.spectrum[n]-a[n],2);return Math.sqrt(s)}calculateMFCC(e){const t=new _(2048);t.forward(e);const s=this.createMelFilters(t.spectrum.length),a=new Float32Array(s.length);for(let l=0;l<s.length;l++)for(let e=0;e<t.spectrum.length;e++)a[l]+=t.spectrum[e]*s[l][e];const n=a.map(e=>Math.log(e+1e-10));return this.dct(n).slice(0,13)}extractAudioFeatures(e){return{spectralCentroid:this.calculateSpectralCentroid(e),spectralRolloff:this.calculateSpectralRolloff(e),spectralFlux:this.calculateSpectralFlux(e),zeroCrossingRate:this.calculateZeroCrossingRate(e),mfcc:this.calculateMFCC(e),transientDensity:this.calculateTransientDensity(e),lowFreqEnergy:this.calculateLowFreqEnergy(e),rhythmicRegularity:this.calculateRhythmicRegularity(e),lowFreqContent:this.calculateLowFreqContent(e),sustain:this.calculateSustain(e),harmonicContent:this.calculateHarmonicContent(e),midFreqContent:this.calculateMidFreqContent(e),harmonicRichness:this.calculateHarmonicRichness(e),transientSharpness:this.calculateTransientSharpness(e),harmonicComplexity:this.calculateHarmonicComplexity(e),dynamicRange:this.calculateDynamicRange(e),highFreqContent:this.calculateHighFreqContent(e),vibrato:this.calculateVibrato(e),bowing:this.calculateBowing(e),formantStructure:this.calculateFormantStructure(e),breathiness:this.calculateBreathiness(e),pitchVariation:this.calculatePitchVariation(e),vocalArticulation:this.calculateVocalArticulation(e)}}calculateZeroCrossingRate(e){let t=0;for(let s=1;s<e.length;s++)(e[s]>=0&&e[s-1]<0||e[s]<0&&e[s-1]>=0)&&t++;return t/e.length}calculateTransientDensity(e){return this.detectTransients(e).length/e.length}calculateLowFreqEnergy(e){const t=new _(2048);t.forward(e);const s=t.spectrum.slice(0,50);return s.reduce((e,t)=>e+t,0)/s.length}calculateRhythmicRegularity(e){return this.analyzeGroove(e).regularity}calculateLowFreqContent(e){const t=new _(2048);t.forward(e);return t.spectrum.slice(0,100).reduce((e,t)=>e+t,0)/t.spectrum.reduce((e,t)=>e+t,0)}calculateSustain(e){const t=this.calculateEnvelope(e);let s=0;for(let c=0;c<t.length;c++)t[c]>s&&(s=t[c]);const a=.05*s;let n=0,l=0,r=0,i=0;for(let c=0;c<t.length;c++)t[c]>a?(n++,l+=t[c],i++):(i>1e3&&r++,i=0);const o=n/t.length*(1+.3*Math.min(1,r/5));return console.log("סוסטיין (פסנתר):",o,"זמן סוסטיין:",n,"סך סוסטיין:",l,"תקופות ארוכות:",r),o}calculateHarmonicContent(e){const t=new _(2048);t.forward(e);const s=t.spectrum;let a=0,n=0;for(let l=1;l<s.length;l++)l%2!=0&&l%3!=0||(a+=s[l]),n+=s[l];return n>0?a/n:0}calculateMidFreqContent(e){const t=new _(2048);t.forward(e);return t.spectrum.slice(100,500).reduce((e,t)=>e+t,0)/t.spectrum.reduce((e,t)=>e+t,0)}calculateHarmonicRichness(e){const t=new _(2048);t.forward(e);const s=t.spectrum;let a=0,n=0;for(let r=0;r<s.length;r++)s[r]>n&&(n=s[r]);const l=.3*n;for(let r=1;r<s.length-1;r++)s[r]>l&&s[r]>s[r-1]&&s[r]>s[r+1]&&a++;return a/s.length}calculateTransientSharpness(e){const t=this.detectTransients(e);if(0===t.length)return 0;let s=0;for(let a=0;a<t.length;a++){const n=t[a];if(n>0&&n<e.length-1){s+=Math.abs(e[n]-e[n-1])+Math.abs(e[n+1]-e[n])}}return s/t.length}calculateHarmonicComplexity(e){const t=new _(2048);t.forward(e);const s=t.spectrum;let a=0,n=0;const l=s.slice(50,800),r=[100,200,300,400,500,600,700,800];let i=0;for(const c of r){const e=Math.floor(c*t.spectrum.length/(this.audioContext.sampleRate/2));e<s.length&&s[e]>.1&&i++}for(let c=1;c<l.length;c++){const e=Math.abs(l[c]-l[c-1]);a+=e,e>.1&&n++}const o=a/l.length*(n/l.length)*(1+.5*(i/r.length));return console.log("מורכבות הרמונית (פסנתר):",o,"הרמוניות:",n,"הרמוניות פסנתר ספציפיות:",i),o}calculateDynamicRange(e){const t=this.calculatePeak(e),s=this.calculateRMS(e),a=20*Math.log10(t/(s+1e-10)),n=Math.max(0,Math.min(1,(a+60)/60));return console.log("טווח דינמי (פסנתר):",n,"דציבלים:",a),n}calculateHighFreqContent(e){const t=new _(2048);t.forward(e);return t.spectrum.slice(500,1e3).reduce((e,t)=>e+t,0)/t.spectrum.reduce((e,t)=>e+t,0)}calculateVibrato(e){const t=new _(2048);t.forward(e);const s=t.spectrum.slice(5,8);return s.reduce((e,t)=>e+t,0)/s.length}calculateBowing(e){const t=this.detectTransients(e);if(t.length<2)return 0;let s=0;for(let a=1;a<t.length;a++){const e=t[a]-t[a-1];e>1e3&&e<5e3&&s++}return s/t.length}calculateFormantStructure(e){const t=new _(2048);t.forward(e);const s=t.spectrum,a=[{start:150,end:350},{start:600,end:1e3},{start:1800,end:2800}];let n=0,l=0;for(const o of a){const e=Math.floor(o.start*t.spectrum.length/(this.audioContext.sampleRate/2)),a=Math.floor(o.end*t.spectrum.length/(this.audioContext.sampleRate/2)),r=s.slice(e,a);n+=r.reduce((e,t)=>e+t,0);let i=0;for(let t=1;t<r.length-1;t++)r[t]>r[t-1]&&r[t]>r[t+1]&&r[t]>.1&&i++;l+=i}const r=s.reduce((e,t)=>e+t,0),i=n/r*(1+.5*Math.min(1,l/10));return console.log("מבנה פורמנטים (ווקאל):",i,"אנרגיה פורמנטים:",n,"אנרגיה כללית:",r,"פיקים:",l),i}calculateBreathiness(e){const t=new _(2048);t.forward(e);const s=t.spectrum,a=s.slice(600,1200),n=s.reduce((e,t)=>e+t,0),l=a.reduce((e,t)=>e+t,0),r=l/n;let i=0;for(let c=1;c<a.length;c++){Math.abs(a[c]-a[c-1])>.05&&i++}const o=r*(1+.3*Math.min(1,i/a.length));return console.log("נשימות (ווקאל):",o,"אנרגיה נשימות:",l,"אנרגיה כללית:",n,"תבניות:",i),o}calculatePitchVariation(e){const t=new _(2048);t.forward(e);const s=t.spectrum;let a=0,n=0;for(let r=1;r<s.length;r++){const e=Math.abs(s[r]-s[r-1]);n+=e,e>.05&&a++}const l=a/s.length;return console.log("שינויי גובה (ווקאל):",l,"שינויים:",a,"סך וריאציה:",n),l}calculateVocalArticulation(e){const t=new _(2048);t.forward(e);const s=t.spectrum,a=[{start:2e3,end:4e3},{start:8e3,end:12e3}];let n=0;for(const r of a){const e=Math.floor(r.start*t.spectrum.length/(this.audioContext.sampleRate/2)),a=Math.floor(r.end*t.spectrum.length/(this.audioContext.sampleRate/2)),l=s.slice(e,a);let i=0;for(let t=1;t<l.length;t++){Math.abs(l[t]-l[t-1])>.1&&i++}n+=i/l.length}const l=n/a.length;return console.log("ארטיקולציה ווקאלית:",l),l}calculateEnvelope(e){const t=new Float32Array(e.length);for(let s=0;s<e.length;s++){const a=Math.max(0,s-100),n=Math.min(e.length,s+100),l=e.slice(a,n);let r=0;for(let e=0;e<l.length;e++){const t=Math.abs(l[e]);t>r&&(r=t)}t[s]=r}return t}createMelFilters(e){const t=[];for(let s=0;s<26;s++){const a=new Float32Array(e),n=this.melToFreq(2595*s/27),l=this.melToFreq(2595*(s-1)/27),r=this.melToFreq(2595*(s+1)/27);for(let t=0;t<e;t++){const s=t*this.audioContext.sampleRate/(2*e);s>=l&&s<=r&&(a[t]=s<=n?(s-l)/(n-l):(r-s)/(r-n))}t.push(a)}return t}melToFreq(e){return 700*(Math.pow(10,e/2595)-1)}dct(e){const t=e.length,s=new Float32Array(t);for(let a=0;a<t;a++){let n=0;for(let s=0;s<t;s++)n+=e[s]*Math.cos(Math.PI*a*(2*s+1)/(2*t));s[a]=n*Math.sqrt(2/t)}return s}getCompressionRecommendations(e){const{dynamicsAnalysis:t,instrumentDetection:s}=e,a=[];if(t.dynamicRange>20){const e=this.findPluginByName("Waves CLA-2A","compression")||this.findAlternativePlugin("compression",s.primaryInstrument);e&&a.push(o(i({},e),{reason:"דינמיקה גבוהה - נדרש קומפרסור עדין",settings:{Attack:"15ms",Release:"100ms",Ratio:"2:1",Threshold:"-20dB"},description:"קומפרסור עדין לדינמיקה גבוהה עם שליטה מדויקת"}))}if("drums"===s.primaryInstrument){const e=this.findPluginByName("Waves SSL G-Master Buss Compressor","compression")||this.findAlternativePlugin("compression","drums");e&&a.push(o(i({},e),{reason:"תופים - נדרש קומפרסור עם אופי SSL",settings:{Attack:"30ms",Release:"100ms",Ratio:"2:1",Threshold:"-20dB"},description:"קומפרסור SSL מקצועי לתופים עם אופי קלאסי"}))}if(0===a.length){const e=this.findAlternativePlugin("compression",s.primaryInstrument);e&&a.push(o(i({},e),{reason:"המלצה כללית לקומפרסור",settings:e.settings,description:e.description}))}return a}getEQRecommendations(e){const{frequencyAnalysis:t,instrumentDetection:s}=e,a=[];if(t.lowFreq<.3){const e=this.findPluginByName("FabFilter Pro-Q3","eq")||this.findAlternativePlugin("eq",s.primaryInstrument);e&&a.push(o(i({},e),{reason:"תדרים נמוכים חלשים - נדרש בוסט",settings:{"Low Shelf":"+3dB",Frequency:"80Hz"},description:"איקיו מדויק לבוסט תדרים נמוכים"}))}if(0===a.length){const e=this.findAlternativePlugin("eq",s.primaryInstrument);e&&a.push(o(i({},e),{reason:"המלצה כללית לאיקיו",settings:e.settings,description:e.description}))}return a}getReverbRecommendations(e){const{genreAnalysis:t,instrumentDetection:s}=e,a=[];if("pop"===t.primaryGenre){const e=this.findPluginByName("Valhalla Room","reverb")||this.findAlternativePlugin("reverb",s.primaryInstrument);e&&a.push(o(i({},e),{reason:"פופ - ריברב מודרני וחלק",settings:{Decay:"2.0s",Mix:"15%"},description:"ריברב מודרני למוזיקת פופ"}))}if(0===a.length){const e=this.findAlternativePlugin("reverb",s.primaryInstrument);e&&a.push(o(i({},e),{reason:"המלצה כללית לריברב",settings:e.settings,description:e.description}))}return a}getDelayRecommendations(e){const{rhythmicAnalysis:t,genreAnalysis:s,instrumentDetection:a}=e,n=[];if(t.tempo>120){const e=this.findPluginByName("EchoBoy","delay")||this.findAlternativePlugin("delay",a.primaryInstrument);e&&n.push(o(i({},e),{reason:"טמפו גבוה - דיליי מהיר",settings:{Feedback:"20%",Mix:"10%"},description:"דיליי מהיר לטמפו גבוה"}))}if(0===n.length){const e=this.findAlternativePlugin("delay",a.primaryInstrument);e&&n.push(o(i({},e),{reason:"המלצה כללית לדיליי",settings:e.settings,description:e.description}))}return n}getSaturationRecommendations(e){const{qualityAnalysis:t,instrumentDetection:s}=e,a=[];if(t.noiseFloor>-40){const e=this.findPluginByName("FabFilter Saturn 2","saturation")||this.findAlternativePlugin("saturation",s.primaryInstrument);e&&a.push(o(i({},e),{reason:"רעש גבוה - סטורציה עדינה",settings:{Drive:"2",Mix:"30%"},description:"סטורציה עדינה לטיפול ברעש"}))}if(0===a.length){const e=this.findAlternativePlugin("saturation",s.primaryInstrument);e&&a.push(o(i({},e),{reason:"המלצה כללית לסטורציה",settings:e.settings,description:e.description}))}return a}getAdditionalRecommendations(e){const t=[];return e.qualityAnalysis.clipping&&t.push({type:"warning",message:"זיהוי קליפינג - יש להוריד את הגיין",action:"Reduce gain by 3-6dB"}),e.frequencyAnalysis.frequencyBalance<.3&&t.push({type:"info",message:"איזון תדרים לא אופטימלי",action:"Consider multiband compression"}),t}}class _{constructor(e){this.size=e,this.real=new Float32Array(e),this.imag=new Float32Array(e),this.spectrum=new Float32Array(e/2)}forward(e){for(let t=0;t<this.size;t++)this.real[t]=e[t]||0,this.imag[t]=0;this.fft(this.real,this.imag);for(let t=0;t<this.size/2;t++)this.spectrum[t]=Math.sqrt(this.real[t]*this.real[t]+this.imag[t]*this.imag[t])}fft(e,t){const s=e.length;if(s<=1)return;const a=s>>1,n=new Float32Array(a),l=new Float32Array(a),r=new Float32Array(a),i=new Float32Array(a);for(let o=0;o<a;o++)n[o]=e[2*o],l[o]=t[2*o],r[o]=e[2*o+1],i[o]=t[2*o+1];this.fft(n,l),this.fft(r,i);for(let o=0;o<a;o++){const c=-2*Math.PI*o/s,d=Math.cos(c),m=Math.sin(c),h=r[o]*d-i[o]*m,u=r[o]*m+i[o]*d;e[o]=n[o]+h,t[o]=l[o]+u,e[o+a]=n[o]-h,t[o+a]=l[o]-u}}}const U=[{key:"compression",label:"קומפרסיה",labelSuffix:e=>` ל${e}`,generalLabel:"קומפרסיה ווקאלית",icon:d.jsx(S,{className:"w-5 h-5 ml-2"})},{key:"eq",label:"איקולייזר",labelSuffix:e=>` ל${e}`,generalLabel:"Equalization",icon:d.jsx(F,{className:"w-5 h-5 ml-2"})},{key:"reverb",label:"ריברב",labelSuffix:e=>` ל${e}`,generalLabel:"ריברב ווקאלי",icon:d.jsx(q,{className:"w-5 h-5 ml-2"})},{key:"delay",label:"דיליי",labelSuffix:e=>` ל${e}`,generalLabel:"דיליי ווקאלי",icon:d.jsx(P,{className:"w-5 h-5 ml-2"})},{key:"saturation",label:"סטורציה",labelSuffix:e=>` ל${e}`,generalLabel:"סטורציה ווקאלית",icon:d.jsx(T,{className:"w-5 h-5 ml-2"})}],J=e=>{switch(e){case"compression":return d.jsx(S,{className:"w-6 h-6"});case"eq":return d.jsx(F,{className:"w-6 h-6"});case"reverb":return d.jsx(q,{className:"w-6 h-6"});case"delay":return d.jsx(P,{className:"w-6 h-6"});case"saturation":return d.jsx(T,{className:"w-6 h-6"});default:return d.jsx(N,{className:"w-6 h-6"})}},Z=e=>{switch(e){case"drums":return d.jsx(k,{className:"w-6 h-6"});case"bass":return d.jsx(D,{className:"w-6 h-6"});default:return d.jsx(R,{className:"w-6 h-6"})}},K=e=>({drums:"תופים",bass:"בס",electric_guitar:"גיטרה חשמלית",acoustic_guitar:"גיטרה אקוסטית",piano:"פסנתר",violin:"כינורות",vocal:"ווקאל",unknown:"לא ידוע"}[e]||"לא ידוע"),X={drums:{compression:[{name:"Waves SSL G-Master Buss Compressor",description:"קומפרסור מקצועי לתופים עם אופי SSL.",price:"199$",category:"compression",color:"bg-blue-500",settings:{Attack:"30ms",Release:"100ms",Ratio:"2:1",Threshold:"-20dB"},features:["SSL sound","Punch"],url:"https://www.waves.com/"},{name:"FabFilter Pro-C2",description:"קומפרסור מדויק עם שליטה מלאה.",price:"299$",category:"compression",color:"bg-green-500",settings:{Attack:"10ms",Release:"50ms",Ratio:"3:1",Threshold:"-15dB"},features:["Sidechain","Lookahead"],url:"https://www.fabfilter.com/"}],eq:[{name:"Waves SSL E-Channel",description:"איקיו בסגנון SSL לתופים.",price:"199$",category:"eq",color:"bg-yellow-500",settings:{"High Pass":"60Hz",High:"+4dB",Low:"-2dB"},features:["SSL sound","Punch"],url:"https://www.waves.com/"}],reverb:[{name:"Valhalla Room",description:"ריברב טבעי לתופים.",price:"חינמי",category:"reverb",color:"bg-purple-500",settings:{Decay:"1.8s",Mix:"12%"},features:["Natural","Fast"],url:"https://valhalladsp.com/"}],delay:[{name:"EchoBoy",description:"דיליי אנלוגי לתופים.",price:"199$",category:"delay",color:"bg-pink-500",settings:{Feedback:"15%",Mix:"8%"},features:["Analog","Sync"],url:"https://www.soundtoys.com/"}],saturation:[{name:"Decapitator",description:"סטורציה לתופים עם אופי אנלוגי.",price:"199$",category:"saturation",color:"bg-red-500",settings:{Drive:"3",Mix:"40%"},features:["Analog","Punch"],url:"https://www.soundtoys.com/"}]},bass:{compression:[{name:"Waves CLA-76",description:"קומפרסור קלאסי לבס.",price:"199$",category:"compression",color:"bg-blue-500",settings:{Attack:"20ms",Release:"200ms",Ratio:"4:1",Threshold:"-18dB"},features:["Analog","Warmth"],url:"https://www.waves.com/"}],eq:[{name:"FabFilter Pro-Q3",description:"איקיו מדויק לבס.",price:"349$",category:"eq",color:"bg-yellow-500",settings:{"Low Cut":"40Hz","High Shelf":"+2dB",Notch:"-3dB"},features:["Dynamic EQ","Linear phase"],url:"https://www.fabfilter.com/"}],reverb:[{name:"Valhalla VintageVerb",description:"ריברב קלאסי לבס.",price:"חינמי",category:"reverb",color:"bg-purple-500",settings:{Decay:"2.0s",Mix:"10%"},features:["Vintage","Warm"],url:"https://valhalladsp.com/"}],delay:[{name:"H-Delay",description:"דיליי מדויק לבס.",price:"129$",category:"delay",color:"bg-yellow-500",settings:{Feedback:"18%",Mix:"6%"},features:["Analog","LoFi"],url:"https://www.waves.com/"}],saturation:[{name:"FabFilter Saturn 2",description:"סטורציה לבס עם אופי חם.",price:"199$",category:"saturation",color:"bg-red-500",settings:{Drive:"4",Mix:"60%"},features:["Multi-band","Warm"],url:"https://www.fabfilter.com/"}]},electric_guitar:{compression:[{name:"Waves CLA-2A",description:"קומפרסור אנלוגי לגיטרה חשמלית.",price:"199$",category:"compression",color:"bg-blue-500",settings:{Attack:"15ms",Release:"100ms",Ratio:"3:1",Threshold:"-20dB"},features:["Analog","Warmth"],url:"https://www.waves.com/"}],eq:[{name:"Waves SSL E-Channel",description:"איקיו בסגנון SSL לגיטרה.",price:"199$",category:"eq",color:"bg-yellow-500",settings:{"High Pass":"80Hz",High:"+3dB",Low:"-1dB"},features:["SSL sound","Flexible"],url:"https://www.waves.com/"}],reverb:[{name:"Valhalla VintageVerb",description:"ריברב קלאסי לגיטרה.",price:"חינמי",category:"reverb",color:"bg-purple-500",settings:{Decay:"2.5s",Mix:"20%"},features:["Vintage","Modulation"],url:"https://valhalladsp.com/"}],delay:[{name:"EchoBoy",description:"דיליי אנלוגי לגיטרה.",price:"199$",category:"delay",color:"bg-pink-500",settings:{Feedback:"25%",Mix:"15%"},features:["Analog","Sync"],url:"https://www.soundtoys.com/"}],saturation:[{name:"Decapitator",description:"סטורציה לגיטרה עם אופי אנלוגי.",price:"199$",category:"saturation",color:"bg-red-500",settings:{Drive:"6",Mix:"50%"},features:["Analog","Punish mode"],url:"https://www.soundtoys.com/"}]},acoustic_guitar:{compression:[{name:"Waves CLA-2A",description:"קומפרסור עדין לגיטרה אקוסטית.",price:"199$",category:"compression",color:"bg-blue-500",settings:{Attack:"25ms",Release:"150ms",Ratio:"2:1",Threshold:"-22dB"},features:["Analog","Natural"],url:"https://www.waves.com/"}],eq:[{name:"FabFilter Pro-Q3",description:"איקיו מדויק לגיטרה אקוסטית.",price:"349$",category:"eq",color:"bg-yellow-500",settings:{"Low Cut":"100Hz","High Shelf":"+1dB",Notch:"-2dB"},features:["Dynamic EQ","Natural"],url:"https://www.fabfilter.com/"}],reverb:[{name:"Valhalla Room",description:"ריברב טבעי לגיטרה אקוסטית.",price:"חינמי",category:"reverb",color:"bg-purple-500",settings:{Decay:"2.0s",Mix:"15%"},features:["Natural","Warm"],url:"https://valhalladsp.com/"}],delay:[{name:"H-Delay",description:"דיליי עדין לגיטרה אקוסטית.",price:"129$",category:"delay",color:"bg-yellow-500",settings:{Feedback:"20%",Mix:"8%"},features:["Analog","Natural"],url:"https://www.waves.com/"}],saturation:[{name:"FabFilter Saturn 2",description:"סטורציה עדינה לגיטרה אקוסטית.",price:"199$",category:"saturation",color:"bg-red-500",settings:{Drive:"2",Mix:"30%"},features:["Multi-band","Natural"],url:"https://www.fabfilter.com/"}]},piano:{compression:[{name:"Waves CLA-2A",description:"קומפרסור עדין לפסנתר.",price:"199$",category:"compression",color:"bg-blue-500",settings:{Attack:"30ms",Release:"200ms",Ratio:"2:1",Threshold:"-25dB"},features:["Analog","Natural"],url:"https://www.waves.com/"}],eq:[{name:"FabFilter Pro-Q3",description:"איקיו מדויק לפסנתר.",price:"349$",category:"eq",color:"bg-yellow-500",settings:{"Low Cut":"80Hz","High Shelf":"+1dB",Notch:"-1dB"},features:["Dynamic EQ","Natural"],url:"https://www.fabfilter.com/"}],reverb:[{name:"Valhalla Room",description:"ריברב טבעי לפסנתר.",price:"חינמי",category:"reverb",color:"bg-purple-500",settings:{Decay:"2.5s",Mix:"20%"},features:["Natural","Warm"],url:"https://valhalladsp.com/"}],delay:[{name:"H-Delay",description:"דיליי עדין לפסנתר.",price:"129$",category:"delay",color:"bg-yellow-500",settings:{Feedback:"15%",Mix:"6%"},features:["Analog","Natural"],url:"https://www.waves.com/"}],saturation:[{name:"FabFilter Saturn 2",description:"סטורציה עדינה לפסנתר.",price:"199$",category:"saturation",color:"bg-red-500",settings:{Drive:"1",Mix:"20%"},features:["Multi-band","Natural"],url:"https://www.fabfilter.com/"}]},violin:{compression:[{name:"Waves CLA-2A",description:"קומפרסור עדין לכינורות.",price:"199$",category:"compression",color:"bg-blue-500",settings:{Attack:"40ms",Release:"250ms",Ratio:"1.5:1",Threshold:"-30dB"},features:["Analog","Natural"],url:"https://www.waves.com/"}],eq:[{name:"FabFilter Pro-Q3",description:"איקיו מדויק לכינורות.",price:"349$",category:"eq",color:"bg-yellow-500",settings:{"Low Cut":"200Hz","High Shelf":"+1dB",Notch:"-1dB"},features:["Dynamic EQ","Natural"],url:"https://www.fabfilter.com/"}],reverb:[{name:"Valhalla Room",description:"ריברב טבעי לכינורות.",price:"חינמי",category:"reverb",color:"bg-purple-500",settings:{Decay:"3.0s",Mix:"25%"},features:["Natural","Warm"],url:"https://valhalladsp.com/"}],delay:[{name:"H-Delay",description:"דיליי עדין לכינורות.",price:"129$",category:"delay",color:"bg-yellow-500",settings:{Feedback:"12%",Mix:"4%"},features:["Analog","Natural"],url:"https://www.waves.com/"}],saturation:[{name:"FabFilter Saturn 2",description:"סטורציה עדינה לכינורות.",price:"199$",category:"saturation",color:"bg-red-500",settings:{Drive:"0.5",Mix:"15%"},features:["Multi-band","Natural"],url:"https://www.fabfilter.com/"}]},vocal:{compression:[{name:"Waves CLA-2A",description:"קומפרסור קלאסי עם אופי אנלוגי.",price:"חינמי",category:"compression",color:"bg-blue-500",settings:{Attack:"10ms",Release:"50ms",Ratio:"4:1",Threshold:"-15dB"},features:["Analog","Warmth"],url:"https://www.waves.com/"}],eq:[{name:"SSL Native Channel Strip",description:"איקיו בסגנון קונסולה.",price:"199$",category:"eq",color:"bg-green-500",settings:{"High Pass":"100Hz",High:"+3dB",Low:"-2dB"},features:["SSL sound","Flexible"],url:"https://www.solidstatelogic.com/"}],reverb:[{name:"Valhalla Room",description:"ריברב מודרני וחלק.",price:"חינמי",category:"reverb",color:"bg-purple-500",settings:{Decay:"2.2s",Mix:"18%"},features:["Natural","Fast"],url:"https://valhalladsp.com/"}],delay:[{name:"H-Delay",description:"דיליי מדויק לכל סגנון.",price:"129$",category:"delay",color:"bg-yellow-500",settings:{Feedback:"22%",Mix:"10%"},features:["Analog","LoFi"],url:"https://www.waves.com/"}],saturation:[{name:"FabFilter Saturn 2",description:"סטורציה צבעונית לכל מטרה.",price:"199$",category:"saturation",color:"bg-red-500",settings:{Drive:"4",Mix:"50%"},features:["Multi-band","Warm"],url:"https://www.fabfilter.com/"}]}},ee=({plugin:e,category:t})=>{return d.jsx(h,{className:"bg-studio-gray border-studio-gray hover:border-blue-500 transition-colors",children:d.jsx(u,{className:"p-6",children:d.jsxs("div",{className:"flex items-start space-x-4 space-x-reverse",children:[d.jsx("div",{className:`w-20 h-20 ${e.color} rounded-lg flex items-center justify-center shadow-lg`,children:J(t)}),d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("h3",{className:"text-lg font-semibold text-white",children:e.name}),d.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(s=e.category,d.jsx("span",{className:`px-2 py-1 rounded text-xs text-white ${{compression:"bg-green-500",eq:"bg-blue-500",reverb:"bg-purple-500",delay:"bg-yellow-500",saturation:"bg-red-500"}[s]||"bg-gray-500"}`,children:s})),d.jsx("span",{className:"font-semibold "+("חינמי"===e.price?"text-green-400":e.price.includes("$299")||e.price.includes("€199")||e.price.includes("$349")?"text-purple-400":"text-blue-400"),children:e.price})]})]}),d.jsx("p",{className:"text-gray-400 text-sm mb-3",children:e.description}),d.jsxs("div",{className:"bg-studio-dark p-3 rounded-lg mb-4",children:[d.jsx("h4",{className:"text-white font-medium mb-2 text-sm",children:"הגדרות מומלצות:"}),d.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(e.settings).map(([e,t])=>d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsxs("span",{className:"text-xs text-gray-500 capitalize",children:[e,":"]}),d.jsx("span",{className:"text-xs text-white font-medium",children:t})]},e))})]}),d.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:e.features.map((e,t)=>d.jsx("span",{className:"px-2 py-1 bg-blue-600 text-white text-xs rounded",children:e},t))}),d.jsx(g,{className:"w-full bg-blue-600 hover:bg-blue-700 text-white",asChild:!0,children:d.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:[d.jsx(I,{className:"w-4 h-4 ml-2"}),"למידע נוסף"]})})]})]})})});var s},te=({analysis:e,isAnalyzing:t})=>{var s,a,n,l;if(t)return d.jsx("div",{className:"mb-8 p-6 bg-studio-gray rounded-lg",children:d.jsxs("div",{className:"flex items-center justify-center space-x-3 space-x-reverse",children:[d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-white",children:"מנתח AI את הקובץ עם YAMNet..."}),d.jsx("p",{className:"text-gray-400 text-sm",children:"זיהוי כלי נגינה, ניתוח תדרים, וניתוח דינמיקה עם מודל Google"})]})]})});if(!e)return null;return d.jsxs("div",{className:"mb-8",children:[e.yamnet?d.jsxs("div",{className:"mb-8",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(Y,{className:"w-6 h-6 text-orange-400 ml-2"}),d.jsx("h3",{className:"text-lg font-semibold text-white",children:"ניתוח YAMNet מתקדם"})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsx(h,{className:"bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(A,{className:"w-6 h-6 text-orange-400 ml-2"}),d.jsx("h4",{className:"text-lg font-semibold text-white",children:"זיהוי צלילים"})]}),d.jsx("div",{className:"space-y-3",children:e.yamnet.yamnetPredictions&&e.yamnet.yamnetPredictions.slice(0,5).map((e,t)=>d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400 text-sm",children:e.className}),d.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[d.jsx("div",{className:"w-20 bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-orange-500 h-2 rounded-full transition-all duration-300",style:{width:100*e.score+"%"}})}),d.jsx("span",{className:"text-xs text-white",children:e.confidence})]})]},t))})]})}),d.jsx(h,{className:"bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(R,{className:"w-6 h-6 text-indigo-400 ml-2"}),d.jsx("h4",{className:"text-lg font-semibold text-white",children:"כלי נגינה משופרים"})]}),d.jsx("div",{className:"space-y-3",children:e.yamnet.instrumentAnalysis&&Object.entries(e.yamnet.instrumentAnalysis).map(([e,t])=>{if(t.length>0){const s=(t.reduce((e,t)=>e+t.score,0)/t.length*100).toFixed(1);return d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400 text-sm capitalize",children:e}),d.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[d.jsx("div",{className:"w-20 bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-indigo-500 h-2 rounded-full transition-all duration-300",style:{width:`${s}%`}})}),d.jsxs("span",{className:"text-xs text-white",children:[s,"%"]})]})]},e)}return null})})]})})]})]}):null,e.advancedTempo?d.jsxs("div",{className:"mb-8",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(P,{className:"w-6 h-6 text-green-400 ml-2"}),d.jsx("h3",{className:"text-lg font-semibold text-white",children:"ניתוח טמפו מתקדם"})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[d.jsx(h,{className:"bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx($,{className:"w-6 h-6 text-green-400 ml-2"}),d.jsx("h4",{className:"text-lg font-semibold text-white",children:"טמפו ראשי"})]}),d.jsxs("div",{className:"text-center",children:[d.jsxs("div",{className:"text-3xl font-bold text-green-400 mb-2",children:[Math.round(e.advancedTempo.primaryTempo)," BPM"]}),d.jsxs("div",{className:"text-sm text-gray-400",children:["ביטחון: ",(100*e.advancedTempo.confidence).toFixed(1),"%"]})]})]})}),d.jsx(h,{className:"bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(R,{className:"w-6 h-6 text-blue-400 ml-2"}),d.jsx("h4",{className:"text-lg font-semibold text-white",children:"מפת ביטים"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-2xl font-bold text-blue-400 mb-2",children:e.advancedTempo.beatMap.length}),d.jsx("div",{className:"text-sm text-gray-400",children:"ביטים שזוהו"})]})]})}),d.jsx(h,{className:"bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(z,{className:"w-6 h-6 text-purple-400 ml-2"}),d.jsx("h4",{className:"text-lg font-semibold text-white",children:"ניתוח Groove"})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400 text-sm",children:"סדירות"}),d.jsxs("span",{className:"text-white text-sm",children:[(100*e.advancedTempo.groove.regularity).toFixed(1),"%"]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400 text-sm",children:"Swing"}),d.jsxs("span",{className:"text-white text-sm",children:[(100*e.advancedTempo.groove.swing).toFixed(1),"%"]})]})]})]})})]}),d.jsx(h,{className:"bg-studio-gray border-studio-gray mt-6",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(L,{className:"w-6 h-6 text-yellow-400 ml-2"}),d.jsx("h4",{className:"text-lg font-semibold text-white",children:"שיטות ניתוח"})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.advancedTempo.analysis&&Object.entries(e.advancedTempo.analysis).map(([e,t])=>d.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-800 rounded-lg",children:[d.jsx("span",{className:"text-gray-400 text-sm capitalize",children:e.replace(/([A-Z])/g," $1").trim()}),d.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[d.jsx("div",{className:"w-16 bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-yellow-500 h-2 rounded-full transition-all duration-300",style:{width:100*(t.confidence||0)+"%"}})}),d.jsxs("span",{className:"text-xs text-white",children:[t.confidence?(100*t.confidence).toFixed(0):"N/A","%"]})]})]},e))})]})})]}):null,d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsx(h,{className:"bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(M,{className:"w-6 h-6 text-blue-400 ml-2"}),d.jsx("h3",{className:"text-lg font-semibold text-white",children:"זיהוי כלי נגינה"})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"כלי ראשי:"}),d.jsx("span",{className:"text-white font-medium",children:K(e.instrumentDetection.primaryInstrument)})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"רמת ביטחון:"}),d.jsxs("span",{className:"text-green-400 font-medium",children:[Math.round(100*e.instrumentDetection.confidence),"%"]})]}),d.jsxs("div",{className:"mt-4",children:[d.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"ניתוח מפורט:"}),d.jsx("div",{className:"space-y-2",children:Object.entries(e.instrumentDetection.allScores).map(([e,t])=>d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsxs("span",{className:"text-xs text-gray-400",children:[K(e),":"]}),d.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[d.jsx("div",{className:"w-20 bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:100*t+"%"}})}),d.jsxs("span",{className:"text-xs text-white",children:[Math.round(100*t),"%"]})]})]},e))})]})]})]})}),d.jsx(h,{className:"bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(F,{className:"w-6 h-6 text-green-400 ml-2"}),d.jsx("h3",{className:"text-lg font-semibold text-white",children:"ניתוח תדרים"})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"תדר דומיננטי:"}),d.jsxs("span",{className:"text-white font-medium",children:[Math.round(e.frequencyAnalysis.dominantFreq),"Hz"]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"איזון תדרים:"}),d.jsxs("span",{className:"text-white font-medium",children:[Math.round(100*e.frequencyAnalysis.frequencyBalance),"%"]})]}),d.jsxs("div",{className:"mt-4",children:[d.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"ספקטרום:"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-xs text-gray-400",children:"נמוכים:"}),d.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[d.jsx("div",{className:"w-20 bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:100*e.frequencyAnalysis.lowFreq+"%"}})}),d.jsxs("span",{className:"text-xs text-white",children:[Math.round(100*e.frequencyAnalysis.lowFreq),"%"]})]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-xs text-gray-400",children:"בינוניים:"}),d.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[d.jsx("div",{className:"w-20 bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-yellow-500 h-2 rounded-full",style:{width:100*e.frequencyAnalysis.midFreq+"%"}})}),d.jsxs("span",{className:"text-xs text-white",children:[Math.round(100*e.frequencyAnalysis.midFreq),"%"]})]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-xs text-gray-400",children:"גבוהים:"}),d.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[d.jsx("div",{className:"w-20 bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:100*e.frequencyAnalysis.highFreq+"%"}})}),d.jsxs("span",{className:"text-xs text-white",children:[Math.round(100*e.frequencyAnalysis.highFreq),"%"]})]})]})]})]})]})]})}),d.jsx(h,{className:"bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(L,{className:"w-6 h-6 text-purple-400 ml-2"}),d.jsx("h3",{className:"text-lg font-semibold text-white",children:"ניתוח דינמיקה"})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"טווח דינמי:"}),d.jsxs("span",{className:"text-white font-medium",children:[Math.round(e.dynamicsAnalysis.dynamicRange),"dB"]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"יחס קומפרסיה:"}),d.jsxs("span",{className:"text-white font-medium",children:[e.dynamicsAnalysis.compression.toFixed(1),":1"]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"טרנזיינטים:"}),d.jsx("span",{className:"text-white font-medium",children:e.dynamicsAnalysis.transients.length})]}),d.jsxs("div",{className:"mt-4",children:[d.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"רמות:"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-xs text-gray-400",children:"RMS:"}),d.jsx("span",{className:"text-xs text-white",children:e.dynamicsAnalysis.rms.toFixed(3)})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-xs text-gray-400",children:"Peak:"}),d.jsx("span",{className:"text-xs text-white",children:e.dynamicsAnalysis.peak.toFixed(3)})]})]})]})]})]})}),d.jsx(h,{className:"bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(z,{className:"w-6 h-6 text-orange-400 ml-2"}),d.jsx("h3",{className:"text-lg font-semibold text-white",children:"ניתוח ריתמי"})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"טמפו:"}),d.jsxs("span",{className:"text-white font-medium",children:[(null==(s=e.enhancedRhythm)?void 0:s.advancedTempo)?Math.round(e.enhancedRhythm.advancedTempo):Math.round(e.rhythmicAnalysis.tempo)," BPM",(null==(a=e.enhancedRhythm)?void 0:a.advancedTempo)&&d.jsx("span",{className:"text-green-400 text-xs mr-2",children:"(מתקדם)"})]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"ביטחון:"}),d.jsx("span",{className:"text-white font-medium",children:(null==(n=e.enhancedRhythm)?void 0:n.tempoConfidence)?`${(100*e.enhancedRhythm.tempoConfidence).toFixed(1)}%`:"N/A"})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"סדירות:"}),d.jsxs("span",{className:"text-white font-medium",children:[Math.round(100*e.rhythmicAnalysis.groove.regularity),"%"]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"סווינג:"}),d.jsx("span",{className:"text-white font-medium",children:e.rhythmicAnalysis.groove.swing.toFixed(2)})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"מורכבות:"}),d.jsxs("span",{className:"text-white font-medium",children:[Math.round(100*e.rhythmicAnalysis.rhythmicComplexity),"%"]})]}),(null==(l=e.enhancedRhythm)?void 0:l.beatMap)&&e.enhancedRhythm.beatMap.length>0&&d.jsxs("div",{className:"mt-4",children:[d.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"ביטים שזוהו:"}),d.jsxs("div",{className:"text-xs text-gray-400",children:[e.enhancedRhythm.beatMap.length," ביטים במשך ",Math.round(e.enhancedRhythm.beatMap[e.enhancedRhythm.beatMap.length-1])," שניות"]})]})]})]})}),d.jsx(h,{className:"bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(B,{className:"w-6 h-6 text-pink-400 ml-2"}),d.jsx("h3",{className:"text-lg font-semibold text-white",children:"ניתוח סגנון"})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"סגנון ראשי:"}),d.jsx("span",{className:"text-white font-medium capitalize",children:e.genreAnalysis.primaryGenre})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"מצב רוח:"}),d.jsx("span",{className:"text-white font-medium capitalize",children:e.genreAnalysis.mood})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"אנרגיה:"}),d.jsxs("span",{className:"text-white font-medium",children:[Math.round(100*e.genreAnalysis.energy),"%"]})]}),e.genreAnalysis.subGenres.length>0&&d.jsxs("div",{className:"mt-4",children:[d.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"תת-סגנונות:"}),d.jsx("div",{className:"flex flex-wrap gap-2",children:e.genreAnalysis.subGenres.map((e,t)=>d.jsx("span",{className:"px-2 py-1 bg-pink-600 text-white text-xs rounded",children:e},t))})]})]})]})}),d.jsx(h,{className:"bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx($,{className:"w-6 h-6 text-red-400 ml-2"}),d.jsx("h3",{className:"text-lg font-semibold text-white",children:"ניתוח איכות"})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"איכות כללית:"}),d.jsxs("span",{className:"text-white font-medium",children:[Math.round(100*e.qualityAnalysis.overallQuality),"%"]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"רמת רעש:"}),d.jsxs("span",{className:"text-white font-medium",children:[Math.round(e.qualityAnalysis.noiseFloor),"dB"]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"Sample Rate:"}),d.jsxs("span",{className:"text-white font-medium",children:[e.qualityAnalysis.sampleRate,"Hz"]})]}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:"Bit Depth:"}),d.jsxs("span",{className:"text-white font-medium",children:[e.qualityAnalysis.bitDepth,"bit"]})]}),e.qualityAnalysis.clipping&&d.jsx("div",{className:"mt-2 p-2 bg-red-900 border border-red-600 rounded",children:d.jsx("span",{className:"text-red-200 text-xs",children:"⚠️ זיהוי קליפינג"})}),e.qualityAnalysis.phaseIssues&&d.jsx("div",{className:"mt-2 p-2 bg-yellow-900 border border-yellow-600 rounded",children:d.jsx("span",{className:"text-yellow-200 text-xs",children:"⚠️ בעיות פאזה"})})]})]})})]})]})},se=({status:e,isProcessing:t,enhancedRecommendations:s,aiSummary:a,aiApiService:n})=>{const l=(null==n?void 0:n.getMetrics())||{},r=l.queueLength||0,i=void 0===l.canMakeRequest||l.canMakeRequest,o=l.requestsPerMinute||0,c=l.modelUsage||{},m=l.currentRateLimitCount||0;return d.jsx(h,{className:"mb-6",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(O,{className:"h-5 w-5 text-blue-500"}),d.jsx("h3",{className:"text-lg font-semibold",children:"סטטוס AI"})]}),m>0&&d.jsx(g,{onClick:()=>{n&&(n.resetRateLimits(),console.log("🔄 איפוס ידני של rate limits בוצע"))},variant:"outline",size:"sm",className:"text-orange-600 border-orange-600 hover:bg-orange-50",children:"🔄 איפוס Rate Limits"})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("div",{className:"w-3 h-3 rounded-full "+(e.available?"bg-green-500":"bg-red-500")}),d.jsx("span",{className:"text-sm",children:e.available?"AI זמין":"AI לא זמין"})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(A,{className:"h-4 w-4 text-blue-500"}),d.jsxs("span",{className:"text-sm",children:["תור: ",r]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(L,{className:"h-4 w-4 text-purple-500"}),d.jsxs("span",{className:"text-sm",children:["בקשות/דקה: ",o]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("div",{className:"w-3 h-3 rounded-full "+(i?"bg-green-500":"bg-yellow-500")}),d.jsx("span",{className:"text-sm",children:i?"יכול לשלוח":"מוגבל"})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(Y,{className:"h-4 w-4 text-indigo-500"}),d.jsxs("span",{className:"text-sm",children:["GPT-4: ",c["gpt-4"]||0," | GPT-3.5: ",c["gpt-3.5-turbo"]||0]})]}),m>0&&d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),d.jsxs("span",{className:"text-sm text-orange-600",children:["Rate Limits: ",m]})]})]}),e.error&&d.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:d.jsx("p",{className:"text-sm text-red-700",children:e.error.includes("429")?"⚠️ OpenAI API מוגבל - המערכת תנסה שוב אוטומטית":e.error})}),t&&d.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),d.jsx("span",{className:"text-sm text-blue-700",children:"מעבד עם AI..."})]})}),s&&d.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:d.jsx("p",{className:"text-sm text-green-700",children:"✅ המלצות AI זמינות"})})]})})},ae=({onFileUpload:e})=>{const[t,s]=m.useState(!1),[a,n]=m.useState(null),[l,r]=m.useState(null),i=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?s(!0):"dragleave"===e.type&&s(!1)},o=t=>{const s=(e=>{const t=e.toLowerCase();return t.includes("drum")||t.includes("kick")||t.includes("snare")||t.includes("hihat")||t.includes("tom")||t.includes("cymbal")?"drums":t.includes("bass")||t.includes("sub")?"bass":t.includes("guitar")||t.includes("gtr")?t.includes("acoustic")?"acoustic_guitar":"electric_guitar":t.includes("piano")||t.includes("keys")?"piano":t.includes("violin")||t.includes("string")?"violin":t.includes("vocal")||t.includes("voice")?"vocal":"unknown"})(t.name);n(t),r(s),e(t,s)};return d.jsxs("div",{className:"mb-8",children:[d.jsxs("div",{className:"bg-studio-gray border-2 border-dashed border-gray-600 rounded-lg p-8 text-center",children:[d.jsx("input",{type:"file",accept:".wav,.mp3,.aiff,.flac",onChange:e=>{e.preventDefault(),e.target.files&&e.target.files[0]&&o(e.target.files[0])},onDragEnter:i,onDragLeave:i,onDragOver:i,onDrop:e=>{e.preventDefault(),e.stopPropagation(),s(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&o(e.dataTransfer.files[0])},className:"hidden",id:"file-upload"}),d.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer",children:d.jsxs("div",{className:"transition-colors "+(t?"border-blue-500 bg-blue-50":""),children:[d.jsx(E,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),d.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"העלה קובץ סטם"}),d.jsx("p",{className:"text-gray-400 mb-4",children:"גרור קובץ לכאן או לחץ לבחירה"}),d.jsx("p",{className:"text-sm text-gray-500",children:"נתמכים: WAV, MP3, AIFF, FLAC"})]})})]}),a&&d.jsx("div",{className:"mt-4 p-4 bg-studio-dark rounded-lg",children:d.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[Z(l),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-medium",children:a.name}),d.jsxs("p",{className:"text-gray-400 text-sm",children:["זוהה: ",K(l)]})]})]})})]})},ne=()=>{console.log("🚀 רכיב ProductionRecommendations נטען בהצלחה");const[e,t]=m.useState(null),[s,a]=m.useState(null),[n,l]=m.useState(null),[r,i]=m.useState(!1),[o,p]=m.useState(null),[x,y]=m.useState(!1),[f,b]=m.useState(null),[S]=m.useState(()=>new G),[F,q]=m.useState(!1),[P,T]=m.useState({available:!1,error:null}),[D,k]=m.useState(null),I=new Q;m.useEffect(()=>{c(void 0,null,function*(){console.log("🔍 בודק זמינות AI API..."),console.log("🔍 בודק חיבור ל-OpenAI API...");const e=yield S.testApiConnection();T(e),console.log("📊 סטטוס AI API:",e),!e.available&&e.error?e.error.includes("429")||e.error.includes("rate limit")?(console.log("⚠️ OpenAI API מוגבל - המערכת תנסה שוב אוטומטית"),console.log("💡 המערכת תעבור למודל זול יותר אוטומטית"),console.log("🎼 בינתיים המערכת המקומית תספק המלצות איכותיות")):console.log("💡 כדי להפעיל את AI, הגדר OpenAI API Key"):e.available?(console.log("✅ AI מומחה למוזיקה זמין ומוכן לניתוח מתקדם"),console.log("🎯 AI יוכל לנתח את הקבצים שלך ולספק המלצות מותאמות אישית")):console.log("⚠️ AI לא זמין - המערכת עובדת עם המלצות מקומיות")})},[S]),m.useEffect(()=>{const e=setInterval(()=>{const e=S.getMetrics();console.log("📊 סטטיסטיקות AI API:",{totalRequests:e.totalRequests,successRate:e.successfulRequests/Math.max(e.totalRequests,1),rateLimitHits:e.rateLimitHits,queueLength:e.queueLength,requestsPerMinute:e.requestsPerMinute,modelUsage:e.modelUsage}),S.cleanupCache()},3e4);return()=>clearInterval(e)},[S]);return d.jsxs("div",{className:"flex-1 bg-studio-dark p-6 overflow-y-auto",children:[d.jsxs("div",{className:"flex items-center justify-between mb-6",children:[d.jsx("h2",{className:"text-2xl font-bold text-white",children:"המלצות פלאגינים מותאמות עם YAMNet"}),console.log("🎵 ממשק המלצות ייצור נטען"),console.log("🎼 המערכת מוכנה לניתוח קבצים והמלצות פלאגינים"),console.log("🎵 המערכת מוכנה לקבלת קבצים לניתוח"),console.log("🎼 המערכת מוכנה לקבלת קבצים לניתוח"),console.log("🎵 המערכת מוכנה לקבלת קבצים לניתוח"),console.log("🎼 המערכת מוכנה לקבלת קבצים לניתוח"),d.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[d.jsxs(g,{onClick:()=>c(void 0,null,function*(){if(x)return I.yamnetAnalyzer.stopRealTimeAnalysis(),y(!1),b(null),console.log("⏹️ ניתוח בזמן אמת הופסק"),console.log("🎵 YAMNet הפסיק לזיהוי בזמן אמת"),console.log("🎼 YAMNet הפסיק לזיהוי בזמן אמת"),console.log("🎵 YAMNet הפסיק לזיהוי בזמן אמת"),console.log("🎼 YAMNet הפסיק לזיהוי בזמן אמת"),console.log("🎵 YAMNet הפסיק לזיהוי בזמן אמת"),void console.log("🎼 YAMNet הפסיק לזיהוי בזמן אמת");y(!0),b(null),console.log("🎤 מתחיל ניתוח בזמן אמת עם YAMNet..."),console.log("🎵 YAMNet יזהה כלי נגינה בזמן אמת"),console.log("🎼 דגם YAMNet מוכן לזיהוי מתקדם"),console.log("🎼 YAMNet יזהה כלי נגינה בזמן אמת"),console.log("🎵 YAMNet יזהה כלי נגינה בזמן אמת"),console.log("🎼 YAMNet יזהה כלי נגינה בזמן אמת"),console.log("🎵 YAMNet יזהה כלי נגינה בזמן אמת"),console.log("🎼 YAMNet יזהה כלי נגינה בזמן אמת");try{(yield I.yamnetAnalyzer.startRealTimeAnalysis(e=>{b(e),console.log("🎵 YAMNet זיהה:",e.slice(0,3).map(e=>`${e.className} (${e.confidence})`))}))?(console.log("✅ ניתוח בזמן אמת התחיל בהצלחה"),console.log("🎤 YAMNet מקשיב ומזהה כלי נגינה בזמן אמת"),console.log("🎼 YAMNet מוכן לזיהוי כלי נגינה בזמן אמת"),console.log("🎵 YAMNet מוכן לזיהוי כלי נגינה בזמן אמת"),console.log("🎼 YAMNet מוכן לזיהוי כלי נגינה בזמן אמת"),console.log("🎵 YAMNet מוכן לזיהוי כלי נגינה בזמן אמת"),console.log("🎼 YAMNet מוכן לזיהוי כלי נגינה בזמן אמת")):(y(!1),alert("שגיאה באתחול ניתוח בזמן אמת. בדוק הרשאות מיקרופון."),console.log("❌ שגיאה באתחול ניתוח בזמן אמת"))}catch(e){console.error("❌ שגיאה בניתוח בזמן אמת:",e),console.log("💡 בדוק הרשאות מיקרופון בדפדפן"),console.log("🎼 YAMNet לא הצליח להתחיל ניתוח בזמן אמת"),console.log("🎵 YAMNet לא הצליח להתחיל ניתוח בזמן אמת"),console.log("🎼 YAMNet לא הצליח להתחיל ניתוח בזמן אמת"),console.log("🎵 YAMNet לא הצליח להתחיל ניתוח בזמן אמת"),console.log("🎼 YAMNet לא הצליח להתחיל ניתוח בזמן אמת"),y(!1)}}),className:"flex items-center space-x-2 space-x-reverse "+(x?"bg-red-600 hover:bg-red-700":"bg-orange-600 hover:bg-orange-700"),children:[d.jsx(w,{className:"w-4 h-4"}),d.jsx("span",{children:x?"עצור ניתוח":"ניתוח בזמן אמת"})]}),d.jsxs("span",{className:"px-3 py-1 bg-green-600 text-white text-sm rounded-full flex items-center",children:[d.jsx(N,{className:"w-3 h-3 ml-1"})," חינמי"]}),d.jsxs("span",{className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-full flex items-center",children:[d.jsx(j,{className:"w-3 h-3 ml-1"})," מקצועי"]}),d.jsxs("span",{className:"px-3 py-1 bg-purple-600 text-white text-sm rounded-full flex items-center",children:[d.jsx(v,{className:"w-3 h-3 ml-1"})," פרימיום"]})]})]}),d.jsx(ae,{onFileUpload:(e,s)=>c(void 0,null,function*(){var n,r;console.log("📁 קובץ חדש הועלה:",e.name),console.log("🎵 סוג סטים שזוהה:",s),console.log("📏 גודל קובץ:",(e.size/1024/1024).toFixed(2),"MB"),t(s),i(!0),k(null),console.log("🔍 מתחיל ניתוח AI מתקדם..."),console.log("📁 קובץ:",e.name),console.log("🎵 סוג סטים:",s),console.log("🎼 המערכת תנתח את הקובץ עם YAMNet ו-AI"),console.log("🎵 YAMNet יזהה כלי נגינה ו-AI יספק המלצות"),console.log("🎼 YAMNet יזהה כלי נגינה ו-AI יספק המלצות"),console.log("🎵 YAMNet יזהה כלי נגינה ו-AI יספק המלצות"),console.log("🎼 YAMNet יזהה כלי נגינה ו-AI יספק המלצות");try{const t=yield I.analyzeAudioFile(e);if(t){console.log("✅ ניתוח AI הושלם בהצלחה"),console.log("🎯 כלי שזוהה:",null==(n=t.instrumentDetection)?void 0:n.primaryInstrument),console.log("📊 ביטחון בזיהוי:",null==(r=t.instrumentDetection)?void 0:r.confidence),console.log("🔧 המלצות שנוצרו:",Object.keys(t.recommendations||{})),console.log("🎼 YAMNet ו-AI ניתחו את הקובץ בהצלחה"),console.log("🎵 המערכת זיהתה כלי נגינה וסיפקה המלצות"),console.log("🎼 המערכת זיהתה כלי נגינה וסיפקה המלצות"),console.log("🎵 המערכת זיהתה כלי נגינה וסיפקה המלצות"),console.log("🎼 המערכת זיהתה כלי נגינה וסיפקה המלצות"),l(t),p(t.recommendations);const e=t.instrumentDetection.primaryInstrument;console.log("=== תוצאות ניתוח AI ==="),console.log("🎵 כלי שזוהה:",e),console.log("📊 כל הציונים:",t.instrumentDetection.allScores),console.log("🔧 המלצות שנוצרו:",t.recommendations),console.log("🎯 ביטחון בזיהוי:",t.instrumentDetection.confidence),console.log("🎼 המערכת תספק המלצות מותאמות לכלי שזוהה"),console.log("🎵 המערכת תספק המלצות פלאגינים מותאמות לכלי שזוהה"),console.log("🎼 המערכת תספק המלצות פלאגינים מותאמות לכלי נגינה"),console.log("🎵 המערכת תספק המלצות פלאגינים מותאמות לכלי נגינה"),console.log("🎼 המערכת תספק המלצות פלאגינים מותאמות לכלי נגינה"),console.log("🎵 המערכת תספק המלצות פלאגינים מותאמות לכלי נגינה"),"vocal"===e?(console.log("🎤 ✅ זיהוי ווקאל אושר - המערכת זיהתה ווקאל"),console.log("🎵 המערכת תספק המלצות מותאמות לווקאל"),console.log("🎼 המערכת תספק המלצות פלאגינים מותאמות לווקאל"),console.log("🎵 המערכת תספק המלצות פלאגינים מותאמות לווקאל"),console.log("🎼 המערכת תספק המלצות פלאגינים מותאמות לווקאל"),console.log("🎵 המערכת תספק המלצות פלאגינים מותאמות לווקאל"),console.log("🎼 המערכת תספק המלצות פלאגינים מותאמות לווקאל")):t.instrumentDetection.allScores.vocal>.2&&(console.log("🎤 ⚠️ זיהוי ווקאל חלקי - יש מאפיינים ווקאליים אבל הכלי הראשי הוא:",e),console.log("🎵 המערכת תספק המלצות מותאמות לכלי הראשי"),console.log("🎼 המערכת תספק המלצות פלאגינים מותאמות לכלי הראשי"),console.log("🎵 המערכת תספק המלצות פלאגינים מותאמות לכלי הראשי"),console.log("🎼 המערכת תספק המלצות פלאגינים מותאמות לכלי הראשי"),console.log("🎵 המערכת תספק המלצות פלאגינים מותאמות לכלי הראשי"),console.log("🎼 המערכת תספק המלצות פלאגינים מותאמות לכלי הראשי"));const s=yield(e=>c(void 0,null,function*(){var t,s;console.log("🚀 מתחיל עיבוד AI..."),q(!0);try{const a=S.getMetrics();console.log("📊 סטטוס לפני שליחה:",{queueLength:a.queueLength,canMakeRequest:a.canMakeRequest,requestsPerMinute:a.requestsPerMinute}),console.log("🤖 שולח ניתוח ל-AI מומחה למוזיקה..."),console.log("📊 נתונים שנשלחים:",{primaryInstrument:null==(t=e.instrumentDetection)?void 0:t.primaryInstrument,confidence:null==(s=e.instrumentDetection)?void 0:s.confidence,features:e.features?Object.keys(e.features):[]});const n=yield S.getAIRecommendations(e,e.recommendations);return n.success?(console.log("✅ המלצות AI התקבלו בהצלחה:",n.recommendations),n.fromCache&&console.log("📋 המלצות AI התקבלו מ-cache"),n.usedFallbackModel&&console.log("⚠️ השתמש במודל גיבוי (GPT-3.5) עקב הגבלת קצב"),console.log("🎯 AI סיפק המלצות מותאמות אישית"),console.log("🔧 קטגוריות המלצות:",Object.keys(n.recommendations||{})),console.log("🎼 AI ניתח את המאפיינים המורכבים של הקובץ"),console.log("✅ המלצות AI מוכנות לשימוש"),k(n.recommendations),n.recommendations):(console.error("❌ שגיאה בקבלת המלצות AI:",n.error),console.log("⚠️ משתמש בהמלצות מקומיות כתחליף"),console.log("📋 המערכת המקומית תספק המלצות איכותיות"),console.log("🎼 המערכת המקומית תספק המלצות איכותיות לכלי נגינה"),console.log("🎵 המערכת המקומית תספק המלצות איכותיות לכלי נגינה"),console.log("🔄 המערכת תנסה שוב אוטומטית בעוד כמה דקות"),null)}catch(a){return console.error("❌ שגיאה בקבלת המלצות AI:",a),console.log("🔄 משתמש בהמלצות מקומיות כתחליף"),null}finally{console.log("🏁 סיום עיבוד AI"),q(!1)}}))(t);s?(console.log("✅ משתמש בהמלצות AI מתקדמות"),console.log("🤖 AI ניתח את הקובץ וסיפק המלצות מותאמות אישית"),console.log("🎼 AI זיהה מאפיינים מורכבים וסיפק המלצות מדויקות")):(console.log("📋 משתמש בהמלצות מקומיות מותאמות"),console.log("🔧 המערכת המקומית זיהתה את הכלי וסיפקה המלצות מתאימות"),console.log("🎵 המערכת המקומית מספקת המלצות איכותיות לכלי שזוהה"),console.log("🎼 המערכת המקומית מספקת המלצות איכותיות לכלי נגינה"),console.log("🎵 המערכת המקומית מספקת המלצות איכותיות לכלי נגינה"),console.log("🎼 המערכת המקומית מספקת המלצות איכותיות לכלי נגינה"),console.log("🎵 המערכת המקומית מספקת המלצות איכותיות לכלי נגינה"));const i=s||t.recommendations,o={compression:i.compression||[],eq:i.eq||[],reverb:i.reverb||[],delay:i.delay||[],saturation:i.saturation||[]};a({stemTypeName:K(e),plugins:o,aiEnhanced:!!s,aiSummary:i.summary||"המלצות AI נוצרו בהצלחה"}),console.log("✅ ניתוח AI הושלם בהצלחה")}else console.log("⚠️ ניתוח AI לא החזיר תוצאות, משתמש בזיהוי לפי שם קובץ"),console.log("📋 המערכת תשתמש בזיהוי לפי שם הקובץ"),console.log("🎵 המערכת תשתמש בזיהוי לפי שם הקובץ כתחליף"),console.log("🎼 המערכת תשתמש בזיהוי לפי שם הקובץ כתחליף"),console.log("🎵 המערכת תשתמש בזיהוי לפי שם הקובץ כתחליף"),console.log("🎼 המערכת תשתמש בזיהוי לפי שם הקובץ כתחליף"),a({stemTypeName:K(s),plugins:X[s]||X.vocal}),console.log("⚠️ הניתוח AI לא הצליח, משתמש בזיהוי לפי שם קובץ")}catch(o){console.error("❌ שגיאה בניתוח AI:",o),console.log("📋 המערכת תשתמש בזיהוי לפי שם הקובץ כתחליף"),console.log("🎵 המערכת תשתמש בזיהוי לפי שם הקובץ כתחליף"),console.log("🎼 המערכת תשתמש בזיהוי לפי שם הקובץ כתחליף"),console.log("🎵 המערכת תשתמש בזיהוי לפי שם הקובץ כתחליף"),console.log("🎼 המערכת תשתמש בזיהוי לפי שם הקובץ כתחליף"),a({stemTypeName:K(s),plugins:X[s]||X.vocal}),console.log("❌ שגיאה בניתוח AI, משתמש בזיהוי לפי שם קובץ")}finally{i(!1),console.log("🏁 ניתוח הושלם"),console.log("🎉 המערכת מוכנה לקבלת קבצים נוספים"),console.log("💡 טיפ: נסה להעלות קבצים שונים כדי לקבל המלצות מותאמות"),console.log("🎵 המערכת תספק המלצות פלאגינים מותאמות לכלי שזוהה"),console.log("🎼 המערכת מוכנה לקבלת קבצים נוספים לניתוח"),console.log("🎵 המערכת מוכנה לקבלת קבצים נוספים לניתוח"),console.log("🎼 המערכת מוכנה לקבלת קבצים נוספים לניתוח"),console.log("🎵 המערכת מוכנה לקבלת קבצים נוספים לניתוח")}})}),d.jsx(se,{status:P,isProcessing:F,enhancedRecommendations:D,aiSummary:null==s?void 0:s.aiSummary,aiApiService:S}),x&&d.jsx(h,{className:"mb-6 bg-studio-gray border-studio-gray",children:d.jsxs(u,{className:"p-6",children:[d.jsxs("div",{className:"flex items-center mb-4",children:[d.jsx(A,{className:"w-6 h-6 text-orange-400 ml-2"}),d.jsx("h3",{className:"text-lg font-semibold text-white",children:"ניתוח בזמן אמת עם YAMNet"})]}),f?d.jsx("div",{className:"space-y-3",children:f.slice(0,3).map((e,t)=>d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-gray-400",children:e.className}),d.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[d.jsx("div",{className:"w-20 bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-orange-500 h-2 rounded-full transition-all duration-300",style:{width:100*e.score+"%"}})}),d.jsx("span",{className:"text-xs text-white",children:e.confidence})]})]},t))}):d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-500"}),d.jsx("span",{className:"text-gray-400",children:"מקשיב..."})]})]})}),d.jsx(te,{analysis:n,isAnalyzing:r}),r&&d.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 mb-6",children:[d.jsxs("div",{className:"flex items-center mb-2",children:[d.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-400 ml-2"}),d.jsx("span",{className:"text-blue-300 font-semibold",children:"מנתח את הקובץ שלך..."})]}),d.jsx("p",{className:"text-blue-200 text-sm",children:"המערכת מבצעת ניתוח AI מתקדם של הקובץ שלך. זה יכול לקחת כמה שניות."})]}),s&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"mb-6",children:[d.jsxs("h3",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[Z(e),d.jsxs("span",{className:"mr-2",children:["המלצות פלאגינים ל",s.stemTypeName]})]}),n&&d.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 mb-6",children:[d.jsxs("div",{className:"flex items-center mb-2",children:[d.jsx(M,{className:"w-5 h-5 text-blue-400 ml-2"}),d.jsx("span",{className:"text-blue-300 font-semibold",children:"המלצות מבוססות ניתוח AI"})]}),d.jsx("p",{className:"text-blue-200 text-sm",children:"המערכת ניתחה את הקובץ שלך וזיהתה מאפיינים ייחודיים. ההמלצות מותאמות אישית למוזיקה שלך."}),d.jsxs("div",{className:"mt-3 text-xs text-blue-300",children:[d.jsx("span",{className:"font-semibold",children:"זיהוי כלי נגינה:"})," ",n.instrumentDetection.primaryInstrument,"(ביטחון: ",Math.round(100*n.instrumentDetection.confidence),"%)"]}),d.jsxs("div",{className:"mt-2 text-xs text-blue-300",children:[d.jsx("span",{className:"font-semibold",children:"ניתוח תדרים:"}),"נמוך: ",Math.round(100*n.frequencyAnalysis.lowFreq),"% | בינוני: ",Math.round(100*n.frequencyAnalysis.midFreq),"% | גבוה: ",Math.round(100*n.frequencyAnalysis.highFreq),"%"]}),d.jsxs("div",{className:"mt-1 text-xs text-blue-300",children:[d.jsx("span",{className:"font-semibold",children:"דינמיקה:"}),"טווח דינמי: ",Math.round(n.dynamicsAnalysis.dynamicRange),"dB | RMS: ",Math.round(100*n.dynamicsAnalysis.rms),"%"]})]}),!n&&d.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4 mb-6",children:[d.jsxs("div",{className:"flex items-center mb-2",children:[d.jsx(C,{className:"w-5 h-5 text-yellow-400 ml-2"}),d.jsx("span",{className:"text-yellow-300 font-semibold",children:"המלצות מבוססות זיהוי שם קובץ"})]}),d.jsx("p",{className:"text-yellow-200 text-sm",children:"הניתוח AI לא הצליח. המערכת משתמשת בזיהוי לפי שם הקובץ להמלצות בסיסיות."})]})]}),U.map(({key:e,label:t,labelSuffix:a,generalLabel:n,icon:l})=>{var r;const i=null==(r=s.plugins)?void 0:r[e];return i?d.jsxs("div",{className:"mb-12",children:[d.jsxs("h3",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[l,t+(a?a(s.stemTypeName):"")]}),d.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:i.map((t,s)=>d.jsx(ee,{plugin:t,category:e},s))})]},e):null})]}),!s&&d.jsxs("div",{className:"text-center py-12",children:[d.jsx(R,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),d.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"העלה קובץ סטם להתחלה"}),d.jsx("p",{className:"text-gray-400 mb-4",children:"המערכת תזהה אוטומטית את סוג הסטם ותמליץ על פלאגינים מותאמים"}),d.jsxs("div",{className:"bg-gray-800/50 border border-gray-600/30 rounded-lg p-4 max-w-md mx-auto",children:[d.jsxs("div",{className:"flex items-center mb-2",children:[d.jsx(M,{className:"w-4 h-4 text-blue-400 ml-2"}),d.jsx("span",{className:"text-blue-300 text-sm font-semibold",children:"ניתוח AI מתקדם"})]}),d.jsx("p",{className:"text-gray-300 text-xs",children:"המערכת תשתמש ב-AI לניתוח מעמיק של הקובץ שלך, כולל זיהוי כלי נגינה, ניתוח תדרים, דינמיקה וריתם."})]})]})]})};export{ne as default};
//# sourceMappingURL=ProductionRecommendations-e72b0ed3.js.map
